<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
 "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns='http://www.w3.org/1999/xhtml'>
<head>
<title>FandocTest.fan</title>
<meta http-equiv='Content-Type' content='text/html; charset=UTF-8'/>
<link rel='stylesheet' type='text/css' href='../style.css' />
</head>
<body>
<div class='breadcrumb'>
<ul>
<li><a href='../index.html'>Doc Index</a></li><li><a href='index.html'>fandoc</a></li><li><a href='src-FandocTest.fan.html'>FandocTest.fan</a></li></ul>
</div>
<div class='src'>
<pre>
<span id='line1'>//</span>
<span id='line2'>// Copyright <b>(</b>c<b>)</b> 2007, Brian Frank and Andy Frank</span>
<span id='line3'>// Licensed under the Academic Free License version 3.0</span>
<span id='line4'>//</span>
<span id='line5'>// History:</span>
<span id='line6'>//   17 Feb 07  Brian Frank  Creation</span>
<span id='line7'>//</span>
<span id='line8'></span>
<span id='line9'>**</span>
<span id='line10'>** FandocTest</span>
<span id='line11'>**</span>
<span id='line12'>@Js</span>
<span id='line13'>class FandocTest : Test</span>
<span id='line14'><b>{</b></span>
<span id='line15'></span>
<span id='line16'>//////////////////////////////////////////////////////////////////////////</span>
<span id='line17'>// Emphasis</span>
<span id='line18'>//////////////////////////////////////////////////////////////////////////</span>
<span id='line19'></span>
<span id='line20'>  Void testEmphasis<b>(</b><b>)</b></span>
<span id='line21'>  <b>{</b></span>
<span id='line22'>    verifyDoc<b>(</b>"*x*", <b>[</b>"&lt;body>", <b>[</b>"&lt;p>", <b>[</b>"&lt;em>", "x"<b>]</b><b>]</b><b>]</b><b>)</b></span>
<span id='line23'>    verifyDoc<b>(</b>"*foo*", <b>[</b>"&lt;body>", <b>[</b>"&lt;p>", <b>[</b>"&lt;em>", "foo"<b>]</b><b>]</b><b>]</b><b>)</b></span>
<span id='line24'>    verifyDoc<b>(</b>"\n*foo*", <b>[</b>"&lt;body>", <b>[</b>"&lt;p>", <b>[</b>"&lt;em>", "foo"<b>]</b><b>]</b><b>]</b><b>)</b></span>
<span id='line25'>    verifyDoc<b>(</b>"alpha *foo* beta", <b>[</b>"&lt;body>", <b>[</b>"&lt;p>", "alpha ", <b>[</b>"&lt;em>", "foo"<b>]</b>, " beta"<b>]</b><b>]</b><b>)</b></span>
<span id='line26'></span>
<span id='line27'>    verifyDoc<b>(</b>"**x**", <b>[</b>"&lt;body>", <b>[</b>"&lt;p>", <b>[</b>"&lt;strong>", "x"<b>]</b><b>]</b><b>]</b><b>)</b></span>
<span id='line28'>    verifyDoc<b>(</b>"\n\n**x**", <b>[</b>"&lt;body>", <b>[</b>"&lt;p>", <b>[</b>"&lt;strong>", "x"<b>]</b><b>]</b><b>]</b><b>)</b></span>
<span id='line29'>    verifyDoc<b>(</b>"alpha **foo** beta", <b>[</b>"&lt;body>", <b>[</b>"&lt;p>", "alpha ", <b>[</b>"&lt;strong>", "foo"<b>]</b>, " beta"<b>]</b><b>]</b><b>)</b></span>
<span id='line30'></span>
<span id='line31'>    ph := FandocParser <b>{</b> parseHeader = false <b>}</b>.parseStr<b>(</b>"\n**foo**"<b>)</b></span>
<span id='line32'>    verifyDocNode<b>(</b>ph, <b>[</b>"&lt;body>", <b>[</b>"&lt;p>", <b>[</b>"&lt;strong>", "foo"<b>]</b><b>]</b><b>]</b><b>)</b></span>
<span id='line33'></span>
<span id='line34'>    // strong nested in emphasis</span>
<span id='line35'>    verifyDoc<b>(</b>"* **wow** *", <b>[</b>"&lt;body>", <b>[</b>"&lt;p>",  <b>[</b>"&lt;em>", " ", <b>[</b>"&lt;strong>", "wow"<b>]</b>, " "<b>]</b><b>]</b><b>]</b><b>)</b></span>
<span id='line36'>    verifyDoc<b>(</b>"You know, *winter\n**really, really**\nsucks*!", <b>[</b>"&lt;body>", <b>[</b>"&lt;p>", "You know, ",</span>
<span id='line37'>      <b>[</b>"&lt;em>", "winter ", <b>[</b>"&lt;strong>", "really, really"<b>]</b>, " sucks"<b>]</b>, "!"<b>]</b><b>]</b><b>)</b></span>
<span id='line38'></span>
<span id='line39'>    // emphasis nested in strong</span>
<span id='line40'>    verifyDoc<b>(</b>"** *wow* **", <b>[</b>"&lt;body>", <b>[</b>"&lt;p>",  <b>[</b>"&lt;strong>", " ", <b>[</b>"&lt;em>", "wow"<b>]</b>, " "<b>]</b><b>]</b><b>]</b><b>)</b></span>
<span id='line41'>    verifyDoc<b>(</b>"You know, **winter\n*really, really*\nsucks**!", <b>[</b>"&lt;body>", <b>[</b>"&lt;p>", "You know, ",</span>
<span id='line42'>      <b>[</b>"&lt;strong>", "winter ", <b>[</b>"&lt;em>", "really, really"<b>]</b>, " sucks"<b>]</b>, "!"<b>]</b><b>]</b><b>)</b></span>
<span id='line43'></span>
<span id='line44'>    verifyDoc<b>(</b>"**`foo`**", <b>[</b>"&lt;body>", <b>[</b>"&lt;p>", <b>[</b>"&lt;strong>", <b>[</b>"&lt;a foo>", "foo"<b>]</b><b>]</b><b>]</b><b>]</b><b>)</b></span>
<span id='line45'>    verifyDoc<b>(</b>"**<b>[</b>some Foo<b>]</b>`foo`**", <b>[</b>"&lt;body>", <b>[</b>"&lt;p>", <b>[</b>"&lt;strong>", <b>[</b>"&lt;a foo>", "some Foo"<b>]</b><b>]</b><b>]</b><b>]</b><b>)</b></span>
<span id='line46'></span>
<span id='line47'>    /* dfn term retired</span>
<span id='line48'>    verifyDoc<b>(</b>"/term/", <b>[</b>"&lt;body>", <b>[</b>"&lt;p>", <b>[</b>"&lt;dfn>", "term"<b>]</b><b>]</b><b>]</b><b>)</b></span>
<span id='line49'>    verifyDoc<b>(</b>"/term/ what it is", <b>[</b>"&lt;body>", <b>[</b>"&lt;p>", <b>[</b>"&lt;dfn>", "term"<b>]</b>, " what it is"<b>]</b><b>]</b><b>)</b></span>
<span id='line50'>    verifyDoc<b>(</b>"/`#jump`/", <b>[</b>"&lt;body>", <b>[</b>"&lt;p>", <b>[</b>"&lt;dfn>", <b>[</b>"&lt;a #jump>", "#jump"<b>]</b><b>]</b><b>]</b><b>]</b><b>)</b></span>
<span id='line51'>    verifyDoc<b>(</b>"/<b>[</b>JUMP<b>]</b>`#jump`/", <b>[</b>"&lt;body>", <b>[</b>"&lt;p>", <b>[</b>"&lt;dfn>", <b>[</b>"&lt;a #jump>", "JUMP"<b>]</b><b>]</b><b>]</b><b>]</b><b>)</b></span>
<span id='line52'>    */</span>
<span id='line53'></span>
<span id='line54'>    // these are normal paragraphs because the symbol</span>
<span id='line55'>    // isn't prefixed with a space</span>
<span id='line56'>    verifyDoc<b>(</b>"a*b", <b>[</b>"&lt;body>", <b>[</b>"&lt;p>", "a*b"<b>]</b><b>]</b><b>)</b></span>
<span id='line57'>    verifyDoc<b>(</b>"a**b", <b>[</b>"&lt;body>", <b>[</b>"&lt;p>", "a**b"<b>]</b><b>]</b><b>)</b></span>
<span id='line58'>    verifyDoc<b>(</b>"a/b", <b>[</b>"&lt;body>", <b>[</b>"&lt;p>", "a/b"<b>]</b><b>]</b><b>)</b></span>
<span id='line59'></span>
<span id='line60'>    // these are normal paragraphs because the symbol is followed by space</span>
<span id='line61'>    verifyDoc<b>(</b>"a * b",  <b>[</b>"&lt;body>", <b>[</b>"&lt;p>", "a * b"<b>]</b><b>]</b><b>)</b></span>
<span id='line62'>    verifyDoc<b>(</b>"a / b",  <b>[</b>"&lt;body>", <b>[</b>"&lt;p>", "a / b"<b>]</b><b>]</b><b>)</b></span>
<span id='line63'>    /*verifyDoc<b>(</b>"a ** b", <b>[</b>"&lt;body>", <b>[</b>"&lt;p>", "a ** b"<b>]</b><b>]</b><b>)</b>*/</span>
<span id='line64'>  <b>}</b></span>
<span id='line65'></span>
<span id='line66'>  Void testEmphasisErr<b>(</b><b>)</b></span>
<span id='line67'>  <b>{</b></span>
<span id='line68'>    verifyDoc<b>(</b>"Alpha beta\ngamma * in *.java,\ndelta.",</span>
<span id='line69'>      <b>[</b>"&lt;body>", <b>[</b>"&lt;p>", "Alpha beta gamma * in *.java, delta."<b>]</b><b>]</b><b>)</b></span>
<span id='line70'>  <b>}</b></span>
<span id='line71'></span>
<span id='line72'>//////////////////////////////////////////////////////////////////////////</span>
<span id='line73'>// Code</span>
<span id='line74'>//////////////////////////////////////////////////////////////////////////</span>
<span id='line75'></span>
<span id='line76'>  Void testCode<b>(</b><b>)</b></span>
<span id='line77'>  <b>{</b></span>
<span id='line78'>    verifyDoc<b>(</b>"Brian's", <b>[</b>"&lt;body>", <b>[</b>"&lt;p>", "Brian's"<b>]</b><b>]</b><b>)</b></span>
<span id='line79'>    verifyDoc<b>(</b>"'x'", <b>[</b>"&lt;body>", <b>[</b>"&lt;p>", <b>[</b>"&lt;code>", "x"<b>]</b><b>]</b><b>]</b><b>)</b></span>
<span id='line80'>    verifyDoc<b>(</b>"a 'x'", <b>[</b>"&lt;body>", <b>[</b>"&lt;p>", "a ", <b>[</b>"&lt;code>", "x"<b>]</b><b>]</b><b>]</b><b>)</b></span>
<span id='line81'>    verifyDoc<b>(</b>"a 'x' b", <b>[</b>"&lt;body>", <b>[</b>"&lt;p>", "a ", <b>[</b>"&lt;code>", "x"<b>]</b>, " b"<b>]</b><b>]</b><b>)</b></span>
<span id='line82'>    verifyDoc<b>(</b>" 'x' b ", <b>[</b>"&lt;body>", <b>[</b>"&lt;p>", <b>[</b>"&lt;code>", "x"<b>]</b>, " b"<b>]</b><b>]</b><b>)</b></span>
<span id='line83'>    verifyDoc<b>(</b>"'x * y / z <b>[</b>`foo`<b>]</b>'", <b>[</b>"&lt;body>", <b>[</b>"&lt;p>", <b>[</b>"&lt;code>", "x * y / z <b>[</b>`foo`<b>]</b>"<b>]</b><b>]</b><b>]</b><b>)</b></span>
<span id='line84'></span>
<span id='line85'>    // test emphasis symbols in code block</span>
<span id='line86'>    verifyDoc<b>(</b>"'*a*'",    <b>[</b>"&lt;body>", <b>[</b>"&lt;p>", <b>[</b>"&lt;code>", "*a*"<b>]</b><b>]</b><b>]</b><b>)</b></span>
<span id='line87'>    verifyDoc<b>(</b>"'**a**'",  <b>[</b>"&lt;body>", <b>[</b>"&lt;p>", <b>[</b>"&lt;code>", "**a**"<b>]</b><b>]</b><b>]</b><b>)</b></span>
<span id='line88'>    verifyDoc<b>(</b>"'/foo/'",  <b>[</b>"&lt;body>", <b>[</b>"&lt;p>", <b>[</b>"&lt;code>", "/foo/"<b>]</b><b>]</b><b>]</b><b>)</b></span>
<span id='line89'>  <b>}</b></span>
<span id='line90'></span>
<span id='line91'>//////////////////////////////////////////////////////////////////////////</span>
<span id='line92'>// Links</span>
<span id='line93'>//////////////////////////////////////////////////////////////////////////</span>
<span id='line94'></span>
<span id='line95'>  Void testLinks<b>(</b><b>)</b></span>
<span id='line96'>  <b>{</b></span>
<span id='line97'>    verifyDoc<b>(</b>"`uri`", <b>[</b>"&lt;body>", <b>[</b>"&lt;p>", <b>[</b>"&lt;a uri>", "uri"<b>]</b><b>]</b><b>]</b><b>)</b></span>
<span id='line98'>    verifyDoc<b>(</b>"a `uri`", <b>[</b>"&lt;body>", <b>[</b>"&lt;p>", "a ", <b>[</b>"&lt;a uri>", "uri"<b>]</b><b>]</b><b>]</b><b>)</b></span>
<span id='line99'>    verifyDoc<b>(</b>"a `uri` b", <b>[</b>"&lt;body>", <b>[</b>"&lt;p>", "a ", <b>[</b>"&lt;a uri>", "uri"<b>]</b>, " b"<b>]</b><b>]</b><b>)</b></span>
<span id='line100'>    verifyDoc<b>(</b>"`uri` b", <b>[</b>"&lt;body>", <b>[</b>"&lt;p>", <b>[</b>"&lt;a uri>", "uri"<b>]</b>, " b"<b>]</b><b>]</b><b>)</b></span>
<span id='line101'>    verifyDoc<b>(</b>"Foo `one` bar `two`.", <b>[</b>"&lt;body>", <b>[</b>"&lt;p>", "Foo ", <b>[</b>"&lt;a one>", "one"<b>]</b>, " bar ", <b>[</b>"&lt;a two>", "two"<b>]</b>, "."<b>]</b><b>]</b><b>)</b></span>
<span id='line102'></span>
<span id='line103'>    verifyDoc<b>(</b>"<b>[</b>cool site<b>]</b>`http://cool/`", <b>[</b>"&lt;body>", <b>[</b>"&lt;p>", <b>[</b>"&lt;a http://cool/>", "cool site"<b>]</b><b>]</b><b>]</b><b>)</b></span>
<span id='line104'>    verifyDoc<b>(</b>"Check <b>[</b>cool site<b>]</b>`http://cool/`!", <b>[</b>"&lt;body>", <b>[</b>"&lt;p>", "Check ", <b>[</b>"&lt;a http://cool/>", "cool site"<b>]</b>, "!"<b>]</b><b>]</b><b>)</b></span>
<span id='line105'>    verifyDoc<b>(</b>"<b>(</b><b>[</b>cool site<b>]</b>`http://cool/`<b>)</b>", <b>[</b>"&lt;body>", <b>[</b>"&lt;p>", "<b>(</b>", <b>[</b>"&lt;a http://cool/>", "cool site"<b>]</b>, "<b>)</b>"<b>]</b><b>]</b><b>)</b></span>
<span id='line106'></span>
<span id='line107'>    // empty <b>[</b><b>]</b> are normal text</span>
<span id='line108'>    verifyDoc<b>(</b>"<b>[</b><b>]</b>", <b>[</b>"&lt;body>", <b>[</b>"&lt;p>", "<b>[</b><b>]</b>"<b>]</b><b>]</b><b>)</b></span>
<span id='line109'>    verifyDoc<b>(</b>"x <b>[</b><b>]</b> y", <b>[</b>"&lt;body>", <b>[</b>"&lt;p>", "x <b>[</b><b>]</b> y"<b>]</b><b>]</b><b>)</b></span>
<span id='line110'>  <b>}</b></span>
<span id='line111'></span>
<span id='line112'>//////////////////////////////////////////////////////////////////////////</span>
<span id='line113'>// Image</span>
<span id='line114'>//////////////////////////////////////////////////////////////////////////</span>
<span id='line115'></span>
<span id='line116'>  Void testImage<b>(</b><b>)</b></span>
<span id='line117'>  <b>{</b></span>
<span id='line118'>    verifyDoc<b>(</b>"!<b>[</b>cool image<b>]</b>`cool.png`", <b>[</b>"&lt;body>", <b>[</b>"&lt;p>", <b>[</b>"&lt;img cool image;cool.png>"<b>]</b><b>]</b><b>]</b><b>)</b></span>
<span id='line119'>    verifyDoc<b>(</b>"!<b>[</b>cool image<b>]</b><b>[</b>100x200<b>]</b>`cool.png`", <b>[</b>"&lt;body>", <b>[</b>"&lt;p>", <b>[</b>"&lt;img cool image;cool.png;100x200>"<b>]</b><b>]</b><b>]</b><b>)</b></span>
<span id='line120'>    verifyDoc<b>(</b>"!<b>[</b>Brian's Idea<b>]</b>`http://foo/idea.gif`", <b>[</b>"&lt;body>", <b>[</b>"&lt;p>", <b>[</b>"&lt;img Brian's Idea;http://foo/idea.gif>"<b>]</b><b>]</b><b>]</b><b>)</b></span>
<span id='line121'>    verifyDoc<b>(</b>"alpha !<b>[</b>x<b>]</b>`img.png` beta", <b>[</b>"&lt;body>", <b>[</b>"&lt;p>", "alpha ", <b>[</b>"&lt;img x;img.png>"<b>]</b>, " beta"<b>]</b><b>]</b><b>)</b></span>
<span id='line122'>    verifyDoc<b>(</b>"<b>[</b>!<b>[</b>x<b>]</b>`img.png`<b>]</b>`#link`", <b>[</b>"&lt;body>", <b>[</b>"&lt;p>", <b>[</b>"&lt;a>", <b>[</b>"&lt;img x;img.png>"<b>]</b><b>]</b><b>]</b><b>]</b><b>)</b></span>
<span id='line123'>  <b>}</b></span>
<span id='line124'></span>
<span id='line125'>//////////////////////////////////////////////////////////////////////////</span>
<span id='line126'>// AnchorIds</span>
<span id='line127'>//////////////////////////////////////////////////////////////////////////</span>
<span id='line128'></span>
<span id='line129'>  Void testAnchorIds<b>(</b><b>)</b></span>
<span id='line130'>  <b>{</b></span>
<span id='line131'>    doc := verifyDoc<b>(</b>"<b>[</b>#xyz<b>]</b>some text\nthe end.", <b>[</b>"&lt;body>", <b>[</b>"&lt;p>", "some text the end."<b>]</b><b>]</b><b>)</b></span>
<span id='line132'>    verifyEq<b>(</b>doc.children.first->anchorId, "xyz"<b>)</b></span>
<span id='line133'></span>
<span id='line134'>    doc = verifyDoc<b>(</b>"Chapter Two <b>[</b>#ch2<b>]</b>\n=======\nblah blah", <b>[</b>"&lt;body>", <b>[</b>"&lt;h3>", "Chapter Two"<b>]</b>, <b>[</b>"&lt;p>", "blah blah"<b>]</b><b>]</b><b>)</b></span>
<span id='line135'>    verifyEq<b>(</b>doc.children.first->anchorId, "ch2"<b>)</b></span>
<span id='line136'></span>
<span id='line137'>    doc = verifyDoc<b>(</b>"<b>[</b>#ch2<b>]</b>Chapter Two\n=======\nblah blah", <b>[</b>"&lt;body>", <b>[</b>"&lt;h3>", "Chapter Two"<b>]</b>, <b>[</b>"&lt;p>", "blah blah"<b>]</b><b>]</b><b>)</b></span>
<span id='line138'>    verifyEq<b>(</b>doc.children.first->anchorId, "ch2"<b>)</b></span>
<span id='line139'>  <b>}</b></span>
<span id='line140'></span>
<span id='line141'>//////////////////////////////////////////////////////////////////////////</span>
<span id='line142'>// Para</span>
<span id='line143'>//////////////////////////////////////////////////////////////////////////</span>
<span id='line144'></span>
<span id='line145'>  Void testPara<b>(</b><b>)</b></span>
<span id='line146'>  <b>{</b></span>
<span id='line147'>    verifyDoc<b>(</b>"", <b>[</b>"&lt;body>"<b>]</b><b>)</b></span>
<span id='line148'>    verifyDoc<b>(</b>"  \n  \n", <b>[</b>"&lt;body>"<b>]</b><b>)</b></span>
<span id='line149'>    verifyDoc<b>(</b>"a", <b>[</b>"&lt;body>", <b>[</b>"&lt;p>", "a"<b>]</b><b>]</b><b>)</b></span>
<span id='line150'>    verifyDoc<b>(</b>"\na", <b>[</b>"&lt;body>", <b>[</b>"&lt;p>", "a"<b>]</b><b>]</b><b>)</b></span>
<span id='line151'>    verifyDoc<b>(</b>"\n\na b c\nd e f.", <b>[</b>"&lt;body>", <b>[</b>"&lt;p>", "a b c d e f."<b>]</b><b>]</b><b>)</b></span>
<span id='line152'>    verifyDoc<b>(</b>"a b c\n\nd e f.  ", <b>[</b>"&lt;body>", <b>[</b>"&lt;p>", "a b c"<b>]</b>, <b>[</b>"&lt;p>", "d e f."<b>]</b><b>]</b><b>)</b></span>
<span id='line153'>    verifyDoc<b>(</b>"alpha\r\nbeta\r\n\r\ngamma\r\n", <b>[</b>"&lt;body>", <b>[</b>"&lt;p>", "alpha beta"<b>]</b>, <b>[</b>"&lt;p>", "gamma"<b>]</b><b>]</b><b>)</b></span>
<span id='line154'>    verifyDoc<b>(</b>"NOTE: that's right", <b>[</b>"&lt;body>", <b>[</b>"&lt;p NOTE>", "that's right"<b>]</b><b>]</b><b>)</b></span>
<span id='line155'>    verifyDoc<b>(</b>"TODO: that's right\nkeep it!", <b>[</b>"&lt;body>", <b>[</b>"&lt;p TODO>", "that's right keep it!"<b>]</b><b>]</b><b>)</b></span>
<span id='line156'>    verifyDoc<b>(</b>"Note: that's right", <b>[</b>"&lt;body>", <b>[</b>"&lt;p>", "Note: that's right"<b>]</b><b>]</b><b>)</b></span>
<span id='line157'>  <b>}</b></span>
<span id='line158'></span>
<span id='line159'>//////////////////////////////////////////////////////////////////////////</span>
<span id='line160'>// Pre</span>
<span id='line161'>//////////////////////////////////////////////////////////////////////////</span>
<span id='line162'></span>
<span id='line163'>  Void testPre<b>(</b><b>)</b></span>
<span id='line164'>  <b>{</b></span>
<span id='line165'>    verifyDoc<b>(</b>"  a+b", <b>[</b>"&lt;body>", <b>[</b>"&lt;pre>", "a+b"<b>]</b><b>]</b><b>)</b></span>
<span id='line166'>    verifyDoc<b>(</b>"a\n\n  foo\n  bar\n\nb", <b>[</b>"&lt;body>", <b>[</b>"&lt;p>", "a"<b>]</b>, <b>[</b>"&lt;pre>", "foo\nbar"<b>]</b>, <b>[</b>"&lt;p>", "b"<b>]</b>,<b>]</b><b>)</b></span>
<span id='line167'></span>
<span id='line168'>    verifyDoc<b>(</b></span>
<span id='line169'>     "  class A</span>
<span id='line170'>        <b>{</b></span>
<span id='line171'>          Int x<b>(</b><b>)</b></span>
<span id='line172'>          <b>{</b></span>
<span id='line173'>            return 3</span>
<span id='line174'>          <b>}</b></span>
<span id='line175'>        <b>}</b></span>
<span id='line176'></span>
<span id='line177'></span>
<span id='line178'>        class B <b>{</b><b>}</b></span>
<span id='line179'>      ",</span>
<span id='line180'>         <b>[</b>"&lt;body>", <b>[</b>"&lt;pre>", "class A\n<b>{</b>\n  Int x<b>(</b><b>)</b>\n  <b>{</b>\n    return 3\n  <b>}</b>\n<b>}</b>\n\n\nclass B <b>{</b><b>}</b>"<b>]</b><b>]</b><b>)</b></span>
<span id='line181'></span>
<span id='line182'>    verifyDoc<b>(</b>"Code:\n  <b>[</b>,<b>]</b>", <b>[</b>"&lt;body>", <b>[</b>"&lt;p>", "Code:"<b>]</b>, <b>[</b>"&lt;pre>", "<b>[</b>,<b>]</b>"<b>]</b><b>]</b><b>)</b></span>
<span id='line183'>  <b>}</b></span>
<span id='line184'></span>
<span id='line185'>//////////////////////////////////////////////////////////////////////////</span>
<span id='line186'>// PreExplicit</span>
<span id='line187'>//////////////////////////////////////////////////////////////////////////</span>
<span id='line188'></span>
<span id='line189'>  Void testPreExplicit<b>(</b><b>)</b></span>
<span id='line190'>  <b>{</b></span>
<span id='line191'>    verifyDoc<b>(</b></span>
<span id='line192'>     "pre></span>
<span id='line193'>        - a</span>
<span id='line194'></span>
<span id='line195'>        - b</span>
<span id='line196'>      &lt;pre</span>
<span id='line197'>      ", <b>[</b>"&lt;body>", <b>[</b>"&lt;pre>", "- a\n\n- b\n"<b>]</b><b>]</b><b>)</b></span>
<span id='line198'></span>
<span id='line199'>    verifyDoc<b>(</b></span>
<span id='line200'>     "pre></span>
<span id='line201'>        a</span>
<span id='line202'>       b</span>
<span id='line203'>      c</span>
<span id='line204'>      &lt;pre</span>
<span id='line205'>      ", <b>[</b>"&lt;body>", <b>[</b>"&lt;pre>", "  a\n b\nc\n"<b>]</b><b>]</b><b>)</b></span>
<span id='line206'></span>
<span id='line207'>    verifyDoc<b>(</b></span>
<span id='line208'>     "pre></span>
<span id='line209'>         3</span>
<span id='line210'>        2</span>
<span id='line211'>           5</span>
<span id='line212'>          4</span>
<span id='line213'>      &lt;pre</span>
<span id='line214'>      ", <b>[</b>"&lt;body>", <b>[</b>"&lt;pre>", " 3\n2\n   5\n  4\n"<b>]</b><b>]</b><b>)</b></span>
<span id='line215'>  <b>}</b></span>
<span id='line216'></span>
<span id='line217'>//////////////////////////////////////////////////////////////////////////</span>
<span id='line218'>// Headings</span>
<span id='line219'>//////////////////////////////////////////////////////////////////////////</span>
<span id='line220'></span>
<span id='line221'>  Void testHeadings<b>(</b><b>)</b></span>
<span id='line222'>  <b>{</b></span>
<span id='line223'>    verifyDoc<b>(</b></span>
<span id='line224'>     "Chapter 1</span>
<span id='line225'>      *********</span>
<span id='line226'></span>
<span id='line227'>      1.1</span>
<span id='line228'>      ===</span>
<span id='line229'>      Alpha</span>
<span id='line230'>      Beta</span>
<span id='line231'></span>
<span id='line232'>      1. 1.1</span>
<span id='line233'>      -----</span>
<span id='line234'>        Foo</span>
<span id='line235'></span>
<span id='line236'>      New Book</span>
<span id='line237'>      ########</span>
<span id='line238'>      Chapter 2</span>
<span id='line239'>      *********</span>
<span id='line240'></span>
<span id='line241'>      Roger - chapter two!</span>
<span id='line242'>      ", <b>[</b>"&lt;body>",</span>
<span id='line243'>            <b>[</b>"&lt;h2>", "Chapter 1"<b>]</b>,</span>
<span id='line244'>            <b>[</b>"&lt;h3>", "1.1"<b>]</b>,</span>
<span id='line245'>            <b>[</b>"&lt;p>", "Alpha Beta"<b>]</b>,</span>
<span id='line246'>            <b>[</b>"&lt;h4>", "1. 1.1"<b>]</b>,</span>
<span id='line247'>            <b>[</b>"&lt;pre>", "Foo"<b>]</b>,</span>
<span id='line248'>            <b>[</b>"&lt;h1>", "New Book"<b>]</b>,</span>
<span id='line249'>            <b>[</b>"&lt;h2>", "Chapter 2"<b>]</b>,</span>
<span id='line250'>            <b>[</b>"&lt;p>", "Roger - chapter two!"<b>]</b>,</span>
<span id='line251'>          <b>]</b><b>)</b></span>
<span id='line252'></span>
<span id='line253'>    verifyDoc<b>(</b>"a\n\n####\nb", <b>[</b>"&lt;body>", <b>[</b>"&lt;p>", "a"<b>]</b>, <b>[</b>"&lt;p>", "#### b"<b>]</b><b>]</b><b>)</b></span>
<span id='line254'>    verifyDoc<b>(</b>"a\n\n===\n\nb", <b>[</b>"&lt;body>", <b>[</b>"&lt;p>", "a"<b>]</b>, <b>[</b>"&lt;p>", "==="<b>]</b>, <b>[</b>"&lt;p>", "b"<b>]</b><b>]</b><b>)</b></span>
<span id='line255'>    verifyDoc<b>(</b>"\n\n------\n", <b>[</b>"&lt;body>", <b>[</b>"&lt;hr>"<b>]</b><b>]</b><b>)</b></span>
<span id='line256'>  <b>}</b></span>
<span id='line257'></span>
<span id='line258'>//////////////////////////////////////////////////////////////////////////</span>
<span id='line259'>// HR</span>
<span id='line260'>//////////////////////////////////////////////////////////////////////////</span>
<span id='line261'></span>
<span id='line262'>  Void testHr<b>(</b><b>)</b></span>
<span id='line263'>  <b>{</b></span>
<span id='line264'>    verifyDoc<b>(</b>"Foo\n\n---\nBar", <b>[</b>"&lt;body>", <b>[</b>"&lt;p>", "Foo"<b>]</b>, <b>[</b>"&lt;hr>"<b>]</b>, <b>[</b>"&lt;p>", "Bar"<b>]</b><b>]</b><b>)</b></span>
<span id='line265'>    verifyDoc<b>(</b>"\n\n---", <b>[</b>"&lt;body>", <b>[</b>"&lt;hr>"<b>]</b><b>]</b><b>)</b></span>
<span id='line266'>    verifyDoc<b>(</b>"\n\n---\n", <b>[</b>"&lt;body>", <b>[</b>"&lt;hr>"<b>]</b><b>]</b><b>)</b></span>
<span id='line267'>  <b>}</b></span>
<span id='line268'></span>
<span id='line269'>//////////////////////////////////////////////////////////////////////////</span>
<span id='line270'>// BlockQuotes</span>
<span id='line271'>//////////////////////////////////////////////////////////////////////////</span>
<span id='line272'></span>
<span id='line273'>  Void testBlockQuotes<b>(</b><b>)</b></span>
<span id='line274'>  <b>{</b></span>
<span id='line275'>    verifyDoc<b>(</b>"> a", <b>[</b>"&lt;body>", <b>[</b>"&lt;blockquote>", <b>[</b>"&lt;p>", "a"<b>]</b><b>]</b><b>]</b><b>)</b></span>
<span id='line276'>    verifyDoc<b>(</b>"> a\n> b c\n> d", <b>[</b>"&lt;body>", <b>[</b>"&lt;blockquote>", <b>[</b>"&lt;p>", "a b c d"<b>]</b><b>]</b><b>]</b><b>)</b></span>
<span id='line277'>    verifyDoc<b>(</b>"> a\nb c\nd\n\np2", <b>[</b>"&lt;body>", <b>[</b>"&lt;blockquote>", <b>[</b>"&lt;p>", "a b c d"<b>]</b><b>]</b>, <b>[</b>"&lt;p>", "p2"<b>]</b><b>]</b><b>)</b></span>
<span id='line278'>    verifyDoc<b>(</b>"> a\nb\n\n> c\nd\ne\n\nf", <b>[</b>"&lt;body>", <b>[</b>"&lt;blockquote>", <b>[</b>"&lt;p>", "a b"<b>]</b>, <b>[</b>"&lt;p>", "c d e"<b>]</b><b>]</b>, <b>[</b>"&lt;p>", "f"<b>]</b><b>]</b><b>)</b></span>
<span id='line279'>    verifyDoc<b>(</b>"> a\n> b\n\n> c\n> d\n> e\n\nf", <b>[</b>"&lt;body>", <b>[</b>"&lt;blockquote>", <b>[</b>"&lt;p>", "a b"<b>]</b>, <b>[</b>"&lt;p>", "c d e"<b>]</b><b>]</b>, <b>[</b>"&lt;p>", "f"<b>]</b><b>]</b><b>)</b></span>
<span id='line280'>  <b>}</b></span>
<span id='line281'></span>
<span id='line282'>//////////////////////////////////////////////////////////////////////////</span>
<span id='line283'>// UL</span>
<span id='line284'>//////////////////////////////////////////////////////////////////////////</span>
<span id='line285'></span>
<span id='line286'>  Void testUL<b>(</b><b>)</b></span>
<span id='line287'>  <b>{</b></span>
<span id='line288'>    verifyDoc<b>(</b></span>
<span id='line289'>     "- a</span>
<span id='line290'></span>
<span id='line291'>      heading</span>
<span id='line292'>      ----", <b>[</b>"&lt;body>", <b>[</b>"&lt;ul>", <b>[</b>"&lt;li>", "a"<b>]</b><b>]</b>, <b>[</b>"&lt;h4>", "heading"<b>]</b><b>]</b><b>)</b></span>
<span id='line293'></span>
<span id='line294'>    verifyDoc<b>(</b>"- a", <b>[</b>"&lt;body>", <b>[</b>"&lt;ul>", <b>[</b>"&lt;li>", "a"<b>]</b><b>]</b><b>]</b><b>)</b></span>
<span id='line295'></span>
<span id='line296'>    verifyDoc<b>(</b></span>
<span id='line297'>     "- a</span>
<span id='line298'>      - b</span>
<span id='line299'>      - c</span>
<span id='line300'>      ",</span>
<span id='line301'>    <b>[</b>"&lt;body>", <b>[</b>"&lt;ul>", <b>[</b>"&lt;li>", "a"<b>]</b>, <b>[</b>"&lt;li>", "b"<b>]</b>, <b>[</b>"&lt;li>", "c"<b>]</b><b>]</b><b>]</b><b>)</b></span>
<span id='line302'></span>
<span id='line303'>    verifyDoc<b>(</b></span>
<span id='line304'>     "- li <b>[</b>link<b>]</b>`uri` text</span>
<span id='line305'>      - li", <b>[</b>"&lt;body>", <b>[</b>"&lt;ul>", <b>[</b>"&lt;li>", "li ", <b>[</b>"&lt;a uri>", "link"<b>]</b>, " text"<b>]</b>, <b>[</b>"&lt;li>", "li"<b>]</b><b>]</b><b>]</b><b>)</b></span>
<span id='line306'></span>
<span id='line307'>    verifyDoc<b>(</b></span>
<span id='line308'>     "- one</span>
<span id='line309'>        - a</span>
<span id='line310'>        - b</span>
<span id='line311'>      - two</span>
<span id='line312'>        - c</span>
<span id='line313'>        - d</span>
<span id='line314'>      ",</span>
<span id='line315'>    <b>[</b>"&lt;body>",</span>
<span id='line316'>      <b>[</b>"&lt;ul>",</span>
<span id='line317'>        <b>[</b>"&lt;li>", "one", <b>[</b>"&lt;ul>", <b>[</b>"&lt;li>", "a"<b>]</b>, <b>[</b>"&lt;li>", "b"<b>]</b><b>]</b><b>]</b>,</span>
<span id='line318'>        <b>[</b>"&lt;li>", "two", <b>[</b>"&lt;ul>", <b>[</b>"&lt;li>", "c"<b>]</b>, <b>[</b>"&lt;li>", "d"<b>]</b><b>]</b><b>]</b><b>]</b><b>]</b><b>)</b></span>
<span id='line319'></span>
<span id='line320'>    verifyDoc<b>(</b></span>
<span id='line321'>     "- one</span>
<span id='line322'>        - a</span>
<span id='line323'>          - i</span>
<span id='line324'>          - j</span>
<span id='line325'>        - b</span>
<span id='line326'>      - two</span>
<span id='line327'>        - c</span>
<span id='line328'>        - d</span>
<span id='line329'>          - k</span>
<span id='line330'>      ",</span>
<span id='line331'>    <b>[</b>"&lt;body>",</span>
<span id='line332'>      <b>[</b>"&lt;ul>",</span>
<span id='line333'>        <b>[</b>"&lt;li>", "one", <b>[</b>"&lt;ul>",</span>
<span id='line334'>          <b>[</b>"&lt;li>", "a", <b>[</b>"&lt;ul>", <b>[</b>"&lt;li>", "i"<b>]</b>, <b>[</b>"&lt;li>", "j"<b>]</b><b>]</b><b>]</b>,</span>
<span id='line335'>          <b>[</b>"&lt;li>", "b"<b>]</b><b>]</b><b>]</b>,</span>
<span id='line336'>        <b>[</b>"&lt;li>", "two", <b>[</b>"&lt;ul>",</span>
<span id='line337'>          <b>[</b>"&lt;li>", "c"<b>]</b>,</span>
<span id='line338'>          <b>[</b>"&lt;li>", "d", <b>[</b>"&lt;ul>", <b>[</b>"&lt;li>", "k"<b>]</b><b>]</b><b>]</b></span>
<span id='line339'>        <b>]</b><b>]</b><b>]</b><b>]</b><b>)</b></span>
<span id='line340'></span>
<span id='line341'>    verifyDoc<b>(</b></span>
<span id='line342'>     "  - a b c</span>
<span id='line343'>          d e f</span>
<span id='line344'>        - g h i j k</span>
<span id='line345'>      l m n o</span>
<span id='line346'>        - p q</span>
<span id='line347'>            r s</span>
<span id='line348'>      ",</span>
<span id='line349'>    <b>[</b>"&lt;body>", <b>[</b>"&lt;ul>", <b>[</b>"&lt;li>", "a b c d e f"<b>]</b>, <b>[</b>"&lt;li>", "g h i j k l m n o"<b>]</b>, <b>[</b>"&lt;li>", "p q", <b>[</b>"&lt;pre>", "r s"<b>]</b><b>]</b><b>]</b><b>]</b><b>)</b></span>
<span id='line350'></span>
<span id='line351'>    verifyDoc<b>(</b></span>
<span id='line352'>     "- 1-a</span>
<span id='line353'>        1-b</span>
<span id='line354'>      - 2-a</span>
<span id='line355'>        2-b</span>
<span id='line356'>      ",</span>
<span id='line357'>      <b>[</b>"&lt;body>", <b>[</b>"&lt;ul>", <b>[</b>"&lt;li>", "1-a 1-b"<b>]</b>, <b>[</b>"&lt;li>", "2-a 2-b"<b>]</b><b>]</b><b>]</b><b>)</b></span>
<span id='line358'></span>
<span id='line359'>    verifyDoc<b>(</b></span>
<span id='line360'>     "- one</span>
<span id='line361'>        line 2</span>
<span id='line362'></span>
<span id='line363'>        one para 2</span>
<span id='line364'>        more</span>
<span id='line365'></span>
<span id='line366'>      - two</span>
<span id='line367'></span>
<span id='line368'>          Int x<b>(</b><b>)</b></span>
<span id='line369'>            <b>{</b></span>
<span id='line370'>              return x</span>
<span id='line371'>            <b>}</b></span>
<span id='line372'></span>
<span id='line373'>          Int y</span>
<span id='line374'></span>
<span id='line375'>        two para another</span>
<span id='line376'>      ",</span>
<span id='line377'>    <b>[</b>"&lt;body>", <b>[</b>"&lt;ul>",</span>
<span id='line378'>      <b>[</b>"&lt;li>", "one line 2", <b>[</b>"&lt;p>", "one para 2 more"<b>]</b><b>]</b>,</span>
<span id='line379'>      <b>[</b>"&lt;li>", "two", <b>[</b>"&lt;pre>", "Int x<b>(</b><b>)</b>\n  <b>{</b>\n    return x\n  <b>}</b>\n\nInt y"<b>]</b>, <b>[</b>"&lt;p>", "two para another"<b>]</b><b>]</b><b>]</b><b>]</b><b>)</b></span>
<span id='line380'>  <b>}</b></span>
<span id='line381'></span>
<span id='line382'>//////////////////////////////////////////////////////////////////////////</span>
<span id='line383'>// OL</span>
<span id='line384'>//////////////////////////////////////////////////////////////////////////</span>
<span id='line385'></span>
<span id='line386'>  Void testOL<b>(</b><b>)</b></span>
<span id='line387'>  <b>{</b></span>
<span id='line388'>    // these are not lists</span>
<span id='line389'>    verifyDoc<b>(</b>"This is\nit. Right?", <b>[</b>"&lt;body>", <b>[</b>"&lt;p>", "This is it. Right?"<b>]</b><b>]</b><b>)</b></span>
<span id='line390'></span>
<span id='line391'>    verifyDoc<b>(</b>"1. one\n2. two", <b>[</b>"&lt;body>", <b>[</b>"&lt;ol 1>", <b>[</b>"&lt;li>", "one"<b>]</b>, <b>[</b>"&lt;li>", "two"<b>]</b><b>]</b><b>]</b><b>)</b></span>
<span id='line392'>    verifyDoc<b>(</b>"  A. one\n  B. two", <b>[</b>"&lt;body>", <b>[</b>"&lt;ol A>", <b>[</b>"&lt;li>", "one"<b>]</b>, <b>[</b>"&lt;li>", "two"<b>]</b><b>]</b><b>]</b><b>)</b></span>
<span id='line393'>    verifyDoc<b>(</b>"a. one\ntwo\nthree", <b>[</b>"&lt;body>", <b>[</b>"&lt;ol a>", <b>[</b>"&lt;li>", "one two three"<b>]</b><b>]</b><b>]</b><b>)</b></span>
<span id='line394'>    verifyDoc<b>(</b>"I. one\nII. two\nIII. three", <b>[</b>"&lt;body>", <b>[</b>"&lt;ol I>", <b>[</b>"&lt;li>", "one"<b>]</b>, <b>[</b>"&lt;li>", "two"<b>]</b>, <b>[</b>"&lt;li>", "three"<b>]</b><b>]</b><b>]</b><b>)</b></span>
<span id='line395'>    verifyDoc<b>(</b>"i. one\nii. two", <b>[</b>"&lt;body>", <b>[</b>"&lt;ol i>", <b>[</b>"&lt;li>", "one"<b>]</b>, <b>[</b>"&lt;li>", "two"<b>]</b><b>]</b><b>]</b><b>)</b></span>
<span id='line396'></span>
<span id='line397'>    verifyDoc<b>(</b></span>
<span id='line398'>     "I. ONE</span>
<span id='line399'>        A. alpha</span>
<span id='line400'>          i. one</span>
<span id='line401'>          ii. two</span>
<span id='line402'>        B. beta</span>
<span id='line403'>      II. TWO</span>
<span id='line404'>        A. gamma</span>
<span id='line405'>        B. delta</span>
<span id='line406'></span>
<span id='line407'>             - a</span>
<span id='line408'>             - b</span>
<span id='line409'>             - c</span>
<span id='line410'></span>
<span id='line411'>           delta continues</span>
<span id='line412'>           again</span>
<span id='line413'></span>
<span id='line414'>             some code</span>
<span id='line415'>               -> foo</span>
<span id='line416'></span>
<span id='line417'>           delta another para</span>
<span id='line418'></span>
<span id='line419'>      ",</span>
<span id='line420'>    <b>[</b>"&lt;body>",</span>
<span id='line421'>      <b>[</b>"&lt;ol I>",</span>
<span id='line422'>        <b>[</b>"&lt;li>", "ONE", <b>[</b>"&lt;ol A>",</span>
<span id='line423'>          <b>[</b>"&lt;li>", "alpha", <b>[</b>"&lt;ol i>",</span>
<span id='line424'>                            <b>[</b>"&lt;li>", "one"<b>]</b>, <b>[</b>"&lt;li>", "two"<b>]</b><b>]</b><b>]</b>,</span>
<span id='line425'>          <b>[</b>"&lt;li>", "beta"<b>]</b><b>]</b><b>]</b>,</span>
<span id='line426'>        <b>[</b>"&lt;li>", "TWO", <b>[</b>"&lt;ol A>",</span>
<span id='line427'>          <b>[</b>"&lt;li>", "gamma"<b>]</b>,</span>
<span id='line428'>          <b>[</b>"&lt;li>", "delta", <b>[</b>"&lt;ul>", <b>[</b>"&lt;li>", "a"<b>]</b>, <b>[</b>"&lt;li>", "b"<b>]</b>, <b>[</b>"&lt;li>", "c"<b>]</b><b>]</b>,</span>
<span id='line429'>                            <b>[</b>"&lt;p>", "delta continues again"<b>]</b>,</span>
<span id='line430'>                            <b>[</b>"&lt;pre>", "some code\n  -> foo"<b>]</b>,</span>
<span id='line431'>                            <b>[</b>"&lt;p>", "delta another para"<b>]</b><b>]</b></span>
<span id='line432'>        <b>]</b><b>]</b><b>]</b><b>]</b><b>)</b></span>
<span id='line433'></span>
<span id='line434'></span>
<span id='line435'>    verifyDoc<b>(</b></span>
<span id='line436'>     "1. 1-a</span>
<span id='line437'>         1-b</span>
<span id='line438'>      2. 2-a</span>
<span id='line439'>         2-b</span>
<span id='line440'></span>
<span id='line441'>         2-c</span>
<span id='line442'>         2-d</span>
<span id='line443'>      ",</span>
<span id='line444'>      <b>[</b>"&lt;body>", <b>[</b>"&lt;ol 1>", <b>[</b>"&lt;li>", "1-a 1-b"<b>]</b>, <b>[</b>"&lt;li>", "2-a 2-b", <b>[</b>"&lt;p>", "2-c 2-d"<b>]</b><b>]</b><b>]</b><b>]</b><b>)</b></span>
<span id='line445'></span>
<span id='line446'>    verifyDoc<b>(</b></span>
<span id='line447'>      "i. 1-a</span>
<span id='line448'>          1-b</span>
<span id='line449'>       ii. 2-a</span>
<span id='line450'>           2-b</span>
<span id='line451'>       iii. 3-a</span>
<span id='line452'>            3-b</span>
<span id='line453'>       ",</span>
<span id='line454'>      <b>[</b>"&lt;body>", <b>[</b>"&lt;ol i>", <b>[</b>"&lt;li>", "1-a 1-b"<b>]</b>, <b>[</b>"&lt;li>", "2-a 2-b"<b>]</b>, <b>[</b>"&lt;li>", "3-a 3-b"<b>]</b><b>]</b><b>]</b><b>)</b></span>
<span id='line455'>  <b>}</b></span>
<span id='line456'></span>
<span id='line457'>//////////////////////////////////////////////////////////////////////////</span>
<span id='line458'>// Meta</span>
<span id='line459'>//////////////////////////////////////////////////////////////////////////</span>
<span id='line460'></span>
<span id='line461'>  Void testMeta<b>(</b><b>)</b></span>
<span id='line462'>  <b>{</b></span>
<span id='line463'>    doc := verifyDoc<b>(</b></span>
<span id='line464'>     "**************************************</span>
<span id='line465'>      ** a: b</span>
<span id='line466'>      ** title: Rocking test here!</span>
<span id='line467'>      **************************************</span>
<span id='line468'></span>
<span id='line469'>      head</span>
<span id='line470'>      ***</span>
<span id='line471'></span>
<span id='line472'>      para", <b>[</b>"&lt;body>", <b>[</b>"&lt;h2>", "head"<b>]</b>, <b>[</b>"&lt;p>", "para"<b>]</b><b>]</b><b>)</b></span>
<span id='line473'></span>
<span id='line474'></span>
<span id='line475'>     verifyEq<b>(</b>doc.meta.size, 2<b>)</b></span>
<span id='line476'>     verifyEq<b>(</b>doc.meta<b>[</b>"a"<b>]</b>, "b"<b>)</b></span>
<span id='line477'>     verifyEq<b>(</b>doc.meta<b>[</b>"title"<b>]</b>, "Rocking test here!"<b>)</b></span>
<span id='line478'>  <b>}</b></span>
<span id='line479'></span>
<span id='line480'>//////////////////////////////////////////////////////////////////////////</span>
<span id='line481'>// Errors</span>
<span id='line482'>//////////////////////////////////////////////////////////////////////////</span>
<span id='line483'></span>
<span id='line484'>  Void testErrs<b>(</b><b>)</b></span>
<span id='line485'>  <b>{</b></span>
<span id='line486'>    verifyErrs<b>(</b>"*i",</span>
<span id='line487'>     <b>[</b>"&lt;body>", <b>[</b>"&lt;p>", "*i"<b>]</b><b>]</b>,</span>
<span id='line488'>     <b>[</b>1, "Invalid *emphasis*"<b>]</b><b>)</b></span>
<span id='line489'></span>
<span id='line490'>    verifyErrs<b>(</b>"a\nb\n**i",</span>
<span id='line491'>     <b>[</b>"&lt;body>", <b>[</b>"&lt;p>", "a b **i"<b>]</b><b>]</b>,</span>
<span id='line492'>     <b>[</b>3, "Invalid **strong**"<b>]</b><b>)</b></span>
<span id='line493'></span>
<span id='line494'>    verifyErrs<b>(</b>"aaaa\nbbbb bbb\n\nccc\n**i",</span>
<span id='line495'>     <b>[</b>"&lt;body>", <b>[</b>"&lt;p>", "aaaa bbbb bbb"<b>]</b>, <b>[</b>"&lt;p>", "ccc **i"<b>]</b><b>]</b>,</span>
<span id='line496'>     <b>[</b>5, "Invalid **strong**"<b>]</b><b>)</b></span>
<span id='line497'></span>
<span id='line498'>    verifyErrs<b>(</b></span>
<span id='line499'>    "abc `foo</span>
<span id='line500'></span>
<span id='line501'>     1. ok</span>
<span id='line502'>     2. *bad</span>
<span id='line503'>     3. **worse</span>
<span id='line504'>     ",</span>
<span id='line505'>     <b>[</b>"&lt;body>", <b>[</b>"&lt;p>", "abc `foo"<b>]</b>, <b>[</b>"&lt;ol 1>", <b>[</b>"&lt;li>", "ok"<b>]</b>, <b>[</b>"&lt;li>", "*bad"<b>]</b>, <b>[</b>"&lt;li>", "**worse"<b>]</b><b>]</b><b>]</b>,</span>
<span id='line506'>     <b>[</b></span>
<span id='line507'>       1, "Invalid uri",</span>
<span id='line508'>       4, "Invalid *emphasis*",</span>
<span id='line509'>       5, "Invalid **strong**",</span>
<span id='line510'>     <b>]</b><b>)</b></span>
<span id='line511'></span>
<span id='line512'>    verifyErrs<b>(</b>"------\na\n- one\n- two",</span>
<span id='line513'>     <b>[</b>"&lt;body>", <b>[</b>"&lt;pre>", "------\na\n- one\n- two"<b>]</b><b>]</b>,</span>
<span id='line514'>     <b>[</b>1, "Invalid line 1"<b>]</b><b>)</b></span>
<span id='line515'>  <b>}</b></span>
<span id='line516'></span>
<span id='line517'>  Void verifyErrs<b>(</b>Str str, Obj<b>[</b><b>]</b> expected, Obj<b>[</b><b>]</b> errs<b>)</b></span>
<span id='line518'>  <b>{</b></span>
<span id='line519'>    parser := FandocParser <b>{</b> silent = true <b>}</b></span>
<span id='line520'>    doc := parser.parse<b>(</b>"Test", str.in<b>)</b></span>
<span id='line521'>    verifyDocNode<b>(</b>doc, expected<b>)</b></span>
<span id='line522'>    // echo<b>(</b>"======"<b>)</b></span>
<span id='line523'>    // parser.errs.each |Err e| <b>{</b> echo<b>(</b>e<b>)</b> <b>}</b></span>
<span id='line524'>    verifyEq<b>(</b>parser.errs.size, errs.size/2<b>)</b></span>
<span id='line525'>    parser.errs.each |FandocErr e, Int i|</span>
<span id='line526'>    <b>{</b></span>
<span id='line527'>      verifyEq<b>(</b>e.file, "Test"<b>)</b></span>
<span id='line528'>      verifyEq<b>(</b>e.line, errs<b>[</b>i*2<b>]</b><b>)</b></span>
<span id='line529'>      verifyEq<b>(</b>e.msg,  errs<b>[</b>i*2+1<b>]</b><b>)</b></span>
<span id='line530'>    <b>}</b></span>
<span id='line531'></span>
<span id='line532'>  <b>}</b></span>
<span id='line533'></span>
<span id='line534'>//////////////////////////////////////////////////////////////////////////</span>
<span id='line535'>// ListItem</span>
<span id='line536'>//////////////////////////////////////////////////////////////////////////</span>
<span id='line537'></span>
<span id='line538'>  Void testToB26<b>(</b><b>)</b></span>
<span id='line539'>  <b>{</b></span>
<span id='line540'>    li := ListIndex<b>(</b>OrderedListStyle.lowerAlpha<b>)</b></span>
<span id='line541'>    verifyEq<b>(</b>li.toStr, "a. "<b>)</b></span>
<span id='line542'>    verifyEq<b>(</b>li.increment.toStr, "b. "<b>)</b></span>
<span id='line543'>    verifyEq<b>(</b>li.increment.toStr, "c. "<b>)</b></span>
<span id='line544'>    verifyEq<b>(</b>li.increment.toStr, "d. "<b>)</b></span>
<span id='line545'>    verifyEq<b>(</b>li.increment.toStr, "e. "<b>)</b></span>
<span id='line546'>    verifyEq<b>(</b>li.increment.toStr, "f. "<b>)</b></span>
<span id='line547'>    verifyEq<b>(</b>li.increment.toStr, "g. "<b>)</b></span>
<span id='line548'></span>
<span id='line549'>    li.index = 25</span>
<span id='line550'>    verifyEq<b>(</b>li.toStr, "y. "<b>)</b></span>
<span id='line551'>    verifyEq<b>(</b>li.increment.toStr, "z. "<b>)</b></span>
<span id='line552'>    verifyEq<b>(</b>li.increment.toStr, "aa. "<b>)</b></span>
<span id='line553'>    verifyEq<b>(</b>li.increment.toStr, "ab. "<b>)</b></span>
<span id='line554'>    verifyEq<b>(</b>li.increment.toStr, "ac. "<b>)</b></span>
<span id='line555'></span>
<span id='line556'>    li = ListIndex<b>(</b>OrderedListStyle.upperAlpha<b>)</b></span>
<span id='line557'>    verifyEq<b>(</b>li.toStr, "A. "<b>)</b></span>
<span id='line558'>    verifyEq<b>(</b>li.increment.toStr, "B. "<b>)</b></span>
<span id='line559'>    verifyEq<b>(</b>li.increment.toStr, "C. "<b>)</b></span>
<span id='line560'>    verifyEq<b>(</b>li.increment.toStr, "D. "<b>)</b></span>
<span id='line561'>    verifyEq<b>(</b>li.increment.toStr, "E. "<b>)</b></span>
<span id='line562'>    verifyEq<b>(</b>li.increment.toStr, "F. "<b>)</b></span>
<span id='line563'>    verifyEq<b>(</b>li.increment.toStr, "G. "<b>)</b></span>
<span id='line564'></span>
<span id='line565'>    li.index = 26</span>
<span id='line566'>    verifyEq<b>(</b>li.toStr, "Z. "<b>)</b></span>
<span id='line567'>    verifyEq<b>(</b>li.increment.toStr, "AA. "<b>)</b></span>
<span id='line568'>    verifyEq<b>(</b>li.increment.toStr, "AB. "<b>)</b></span>
<span id='line569'>    verifyEq<b>(</b>li.increment.toStr, "AC. "<b>)</b></span>
<span id='line570'>  <b>}</b></span>
<span id='line571'></span>
<span id='line572'>  Void testToRoman<b>(</b><b>)</b></span>
<span id='line573'>  <b>{</b></span>
<span id='line574'>    li := ListIndex<b>(</b>OrderedListStyle.lowerRoman<b>)</b></span>
<span id='line575'>    verifyEq<b>(</b>li.toStr, "i. "<b>)</b></span>
<span id='line576'>    verifyEq<b>(</b>li.increment.toStr, "ii. "<b>)</b></span>
<span id='line577'>    verifyEq<b>(</b>li.increment.toStr, "iii. "<b>)</b></span>
<span id='line578'>    verifyEq<b>(</b>li.increment.toStr, "iv. "<b>)</b></span>
<span id='line579'>    verifyEq<b>(</b>li.increment.toStr, "v. "<b>)</b></span>
<span id='line580'>    verifyEq<b>(</b>li.increment.toStr, "vi. "<b>)</b></span>
<span id='line581'>    verifyEq<b>(</b>li.increment.toStr, "vii. "<b>)</b></span>
<span id='line582'></span>
<span id='line583'>    li.index = 26</span>
<span id='line584'>    verifyEq<b>(</b>li.toStr, "xxvi. "<b>)</b></span>
<span id='line585'>    verifyEq<b>(</b>li.increment.toStr, "xxvii. "<b>)</b></span>
<span id='line586'>    verifyEq<b>(</b>li.increment.toStr, "xxviii. "<b>)</b></span>
<span id='line587'>    verifyEq<b>(</b>li.increment.toStr, "xxix. "<b>)</b></span>
<span id='line588'></span>
<span id='line589'>    li = ListIndex<b>(</b>OrderedListStyle.upperRoman<b>)</b></span>
<span id='line590'>    verifyEq<b>(</b>li.toStr, "I. "<b>)</b></span>
<span id='line591'>    verifyEq<b>(</b>li.increment.toStr, "II. "<b>)</b></span>
<span id='line592'>    verifyEq<b>(</b>li.increment.toStr, "III. "<b>)</b></span>
<span id='line593'>    verifyEq<b>(</b>li.increment.toStr, "IV. "<b>)</b></span>
<span id='line594'>    verifyEq<b>(</b>li.increment.toStr, "V. "<b>)</b></span>
<span id='line595'>    verifyEq<b>(</b>li.increment.toStr, "VI. "<b>)</b></span>
<span id='line596'>    verifyEq<b>(</b>li.increment.toStr, "VII. "<b>)</b></span>
<span id='line597'></span>
<span id='line598'>    li.index = 26</span>
<span id='line599'>    verifyEq<b>(</b>li.toStr, "XXVI. "<b>)</b></span>
<span id='line600'>    verifyEq<b>(</b>li.increment.toStr, "XXVII. "<b>)</b></span>
<span id='line601'>    verifyEq<b>(</b>li.increment.toStr, "XXVIII. "<b>)</b></span>
<span id='line602'>    verifyEq<b>(</b>li.increment.toStr, "XXIX. "<b>)</b></span>
<span id='line603'>  <b>}</b></span>
<span id='line604'></span>
<span id='line605'>//////////////////////////////////////////////////////////////////////////</span>
<span id='line606'>// VerifyDoc</span>
<span id='line607'>//////////////////////////////////////////////////////////////////////////</span>
<span id='line608'></span>
<span id='line609'>  Doc verifyDoc<b>(</b>Str str, Obj<b>[</b><b>]</b> expected<b>)</b></span>
<span id='line610'>  <b>{</b></span>
<span id='line611'>    parser := FandocParser <b>{</b> silent = true <b>}</b></span>
<span id='line612'>    doc := parser.parse<b>(</b>"Test", str.in<b>)</b></span>
<span id='line613'></span>
<span id='line614'>    // echo<b>(</b>"__________________\n$str\n\n"<b>)</b></span>
<span id='line615'>    // doc.write<b>(</b>HtmlDocWriter<b>(</b><b>)</b><b>)</b></span>
<span id='line616'></span>
<span id='line617'>    verifyDocNode<b>(</b>doc, expected<b>)</b></span>
<span id='line618'></span>
<span id='line619'>    roundtrip := StrBuf<b>(</b><b>)</b></span>
<span id='line620'>    doc.write<b>(</b>FandocDocWriter<b>(</b>roundtrip.out<b>)</b><b>)</b></span>
<span id='line621'>    // echo; echo<b>(</b>roundtrip.toStr<b>)</b></span>
<span id='line622'>    doc2 := parser.parse<b>(</b>"Test-2", roundtrip.toStr.in<b>)</b></span>
<span id='line623'>    verifyDocNode<b>(</b>doc2, expected<b>)</b></span>
<span id='line624'></span>
<span id='line625'>    return doc</span>
<span id='line626'>  <b>}</b></span>
<span id='line627'></span>
<span id='line628'>  Void verifyDocNode<b>(</b>DocElem actual, Obj<b>[</b><b>]</b> expected<b>)</b></span>
<span id='line629'>  <b>{</b></span>
<span id='line630'>    // first item is &lt;elem>, rest are children nodes</span>
<span id='line631'>    expectedElem := expected.first</span>
<span id='line632'>    expectedKids := expected<b>[</b>1..-1<b>]</b></span>
<span id='line633'></span>
<span id='line634'>    elemName := expectedElem.toStr<b>[</b>1..-2<b>]</b></span>
<span id='line635'>    olStyle := OrderedListStyle.number</span>
<span id='line636'>    if <b>(</b>elemName.startsWith<b>(</b>"ol"<b>)</b><b>)</b></span>
<span id='line637'>    <b>{</b></span>
<span id='line638'>      olStyle = OrderedListStyle.fromFirstChar<b>(</b>elemName<b>[</b>-1<b>]</b><b>)</b></span>
<span id='line639'>      elemName = "ol"</span>
<span id='line640'>      verifyEq<b>(</b>actual->style, olStyle<b>)</b></span>
<span id='line641'>    <b>}</b></span>
<span id='line642'>    else if <b>(</b>elemName.startsWith<b>(</b>"p "<b>)</b><b>)</b></span>
<span id='line643'>    <b>{</b></span>
<span id='line644'>      admonition := elemName<b>[</b>2..-1<b>]</b></span>
<span id='line645'>      elemName = "p"</span>
<span id='line646'>      verifyEq<b>(</b>actual->admonition, admonition<b>)</b></span>
<span id='line647'>    <b>}</b></span>
<span id='line648'>    else if <b>(</b>elemName.startsWith<b>(</b>"a "<b>)</b><b>)</b></span>
<span id='line649'>    <b>{</b></span>
<span id='line650'>      uri := elemName<b>[</b>2..-1<b>]</b></span>
<span id='line651'>      elemName = "a"</span>
<span id='line652'>      verifyEq<b>(</b>actual->uri, uri<b>)</b></span>
<span id='line653'>    <b>}</b></span>
<span id='line654'>    else if <b>(</b>elemName.startsWith<b>(</b>"img "<b>)</b><b>)</b></span>
<span id='line655'>    <b>{</b></span>
<span id='line656'>      body := elemName<b>[</b>4..-1<b>]</b></span>
<span id='line657'>      elemName = "img"</span>
<span id='line658'>      verifyEq<b>(</b>actual->alt, body.split<b>(</b>';'<b>)</b><b>[</b>0<b>]</b><b>)</b></span>
<span id='line659'>      verifyEq<b>(</b>actual->uri, body.split<b>(</b>';'<b>)</b><b>[</b>1<b>]</b><b>)</b></span>
<span id='line660'>      verifyEq<b>(</b>actual->size, body.split<b>(</b>';'<b>)</b>.getSafe<b>(</b>2<b>)</b><b>)</b></span>
<span id='line661'>    <b>}</b></span>
<span id='line662'></span>
<span id='line663'>    verifyEq<b>(</b>actual.htmlName, elemName<b>)</b></span>
<span id='line664'>    if <b>(</b>actual.children.size != expectedKids.size<b>)</b></span>
<span id='line665'>    <b>{</b></span>
<span id='line666'>      echo<b>(</b>""<b>)</b></span>
<span id='line667'>      echo<b>(</b>"actual   = $actual.children"<b>)</b></span>
<span id='line668'>      echo<b>(</b>"expected = $expectedKids"<b>)</b></span>
<span id='line669'>    <b>}</b></span>
<span id='line670'>    verifyEq<b>(</b>actual.children.size, expectedKids.size<b>)</b></span>
<span id='line671'>    actual.children.size.times |Int i|</span>
<span id='line672'>    <b>{</b></span>
<span id='line673'>      a := actual.children<b>[</b>i<b>]</b></span>
<span id='line674'>      e := expectedKids<b>[</b>i<b>]</b></span>
<span id='line675'>      if <b>(</b>a is DocElem<b>)</b></span>
<span id='line676'>      <b>{</b></span>
<span id='line677'>        verifyDocNode<b>(</b><b>(</b>DocElem<b>)</b>a, <b>(</b>Obj<b>[</b><b>]</b><b>)</b>e<b>)</b></span>
<span id='line678'>      <b>}</b></span>
<span id='line679'>      else</span>
<span id='line680'>      <b>{</b></span>
<span id='line681'>        verifyType<b>(</b>a, DocText#<b>)</b></span>
<span id='line682'>        if <b>(</b>a->str != e<b>)</b> <b>{</b></span>
<span id='line683'>            Env.cur.err.printLine<b>(</b>"-----"<b>)</b></span>
<span id='line684'>            Env.cur.err.printLine<b>(</b>a->str<b>)</b></span>
<span id='line685'>            Env.cur.err.printLine<b>(</b>" != "<b>)</b></span>
<span id='line686'>            Env.cur.err.printLine<b>(</b>e<b>)</b></span>
<span id='line687'>            Env.cur.err.printLine<b>(</b>"-----"<b>)</b></span>
<span id='line688'>        <b>}</b></span>
<span id='line689'>        verifyEq<b>(</b>a->str, e<b>)</b></span>
<span id='line690'>      <b>}</b></span>
<span id='line691'>    <b>}</b></span>
<span id='line692'>  <b>}</b></span>
<span id='line693'></span>
<span id='line694'><b>}</b></span>
</pre>
</div>
</body>
</html>
