<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
 "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns='http://www.w3.org/1999/xhtml'>
<head>
<title>FontData.fan</title>
<meta http-equiv='Content-Type' content='text/html; charset=UTF-8'/>
<link rel='stylesheet' type='text/css' href='../style.css' />
</head>
<body>
<div class='breadcrumb'>
<ul>
<li><a href='../index.html'>Doc Index</a></li><li><a href='index.html'>graphics</a></li><li><a href='FontData.html'>FontData</a></li><li><a href='src-FontData.fan.html'>FontData.fan</a></li></ul>
</div>
<div class='src'>
<pre>
<span id='line1'>//</span>
<span id='line2'>// Copyright <b>(</b>c<b>)</b> 2017, Brian Frank and Andy Frank</span>
<span id='line3'>// Licensed under the Academic Free License version 3.0</span>
<span id='line4'>//</span>
<span id='line5'>// History:</span>
<span id='line6'>//   15 May 2017  Brian Frank  Creation</span>
<span id='line7'>//</span>
<span id='line8'></span>
<span id='line9'>**</span>
<span id='line10'>** FontData stores metrics for unicode chars from 0x20 to 0xff for a</span>
<span id='line11'>** predefined set of fonts.  For each font style we store a list of</span>
<span id='line12'>** unique widths <b>(</b>in points<b>)</b> for the font at 1000pt.  Then we map the</span>
<span id='line13'>** width for each char in the range using a single ASCII char as an</span>
<span id='line14'>** index to the width table with the char '%' 37 + index <b>(</b>we use '%'</span>
<span id='line15'>** because is avoids both double quote and dollar chars<b>)</b>.</span>
<span id='line16'>**</span>
<span id='line17'>@Js @NoDoc</span>
<span id='line18'>const class FontData</span>
<span id='line19'><b>{</b></span>
<span id='line20'></span>
<span id='line21'>//////////////////////////////////////////////////////////////////////////</span>
<span id='line22'>// Registry</span>
<span id='line23'>//////////////////////////////////////////////////////////////////////////</span>
<span id='line24'></span>
<span id='line25'>  ** Lookup metrics for font by key</span>
<span id='line26'>  static FontData? find<b>(</b>Font f<b>)</b></span>
<span id='line27'>  <b>{</b></span>
<span id='line28'>    registry<b>[</b>toKey<b>(</b>f.style, f.weight, f.name<b>)</b><b>]</b></span>
<span id='line29'>  <b>}</b></span>
<span id='line30'></span>
<span id='line31'>  ** Table keyed by "&lt;style> &lt;weight> &lt;name>"</span>
<span id='line32'>  const static Str:FontData registry</span>
<span id='line33'>  static</span>
<span id='line34'>  <b>{</b></span>
<span id='line35'>    acc := OrderedMap&lt;Str,FontData><b>(</b><b>)</b></span>
<span id='line36'>    try</span>
<span id='line37'>    <b>{</b></span>
<span id='line38'>      // Auto-generated by fontmetrics.html <b>[</b>Mon May 15 2017 18:09:08 GMT-0400 <b>(</b>EDT<b>)</b><b>]</b></span>
<span id='line39'>      register<b>(</b>acc, make<b>(</b>"normal 400 Helvetica",770,230,<b>[</b>0,191,222,260,278,334,355,365,370,389,400,469,500,537,549,556,576,584,611,667,722,737,778,834,889,944,1000,1015<b>]</b>,"<b>)</b><b>)</b>+44=8&amp;**.6<b>)</b>*<b>)</b><b>)</b>4444444444<b>)</b><b>)</b>6664@889987;9<b>)</b>184&lt;9;8;98798>887<b>)</b><b>)</b><b>)</b>04*44144<b>)</b>44''1'&lt;4444*1<b>)</b>419111*<b>(</b>*6%%%%%%?%%%%%%%%%%%%%%%%%%%%%%%%%%<b>)</b>*4444<b>(</b>4*:-46%:*/3***52<b>)</b>**,4&lt;&lt;&lt;7888888?98888<b>)</b><b>)</b><b>)</b><b>)</b>99;;;;;6;9999887444444=14444<b>)</b><b>)</b><b>)</b><b>)</b>4444444374444141"<b>)</b><b>)</b></span>
<span id='line40'>      register<b>(</b>acc, make<b>(</b>"normal 700 Helvetica",770,230,<b>[</b>0,238,280,333,365,370,389,400,474,500,549,556,576,584,611,667,722,737,778,834,889,944,975,1000<b>]</b>,"'<b>(</b>-0095&amp;<b>(</b><b>(</b>+2'<b>(</b>''0000000000<b>(</b><b>(</b>2223;55554375'0538574754354:443<b>(</b>'<b>(</b>20<b>(</b>03030<b>(</b>33''0'93333+0<b>(</b>30700.+'+2%%%%%%&lt;%%%%%%%%%%%%%%%%%%%%%%%%%%'<b>(</b>0000'0<b>(</b>6*02%6<b>(</b>,/<b>(</b><b>(</b><b>(</b>10'<b>(</b><b>(</b><b>)</b>08883555555&lt;54444''''5577777275555443000000900000''''3333333/33333030"<b>)</b><b>)</b></span>
<span id='line41'>      register<b>(</b>acc, make<b>(</b>"italic 400 Helvetica",770,230,<b>[</b>0,191,222,260,278,334,355,365,370,389,400,469,500,537,549,556,576,584,611,667,722,737,778,834,889,944,1000,1015<b>]</b>,"<b>)</b><b>)</b>+44=8&amp;**.6<b>)</b>*<b>)</b><b>)</b>4444444444<b>)</b><b>)</b>6664@889987;9<b>)</b>184&lt;9;8;98798>887<b>)</b><b>)</b><b>)</b>04*44144<b>)</b>44''1'&lt;4444*1<b>)</b>419111*<b>(</b>*6%%%%%%?%%%%%%%%%%%%%%%%%%%%%%%%%%<b>)</b>*4444<b>(</b>4*:-46%:*/3***52<b>)</b>**,4&lt;&lt;&lt;7888888?98888<b>)</b><b>)</b><b>)</b><b>)</b>99;;;;;6;9999887444444=14444<b>)</b><b>)</b><b>)</b><b>)</b>4444444374444141"<b>)</b><b>)</b></span>
<span id='line42'>      register<b>(</b>acc, make<b>(</b>"italic 700 Helvetica",770,230,<b>[</b>0,238,280,333,365,370,389,400,474,500,549,556,576,584,611,667,722,737,778,834,889,944,975,1000<b>]</b>,"'<b>(</b>-0095&amp;<b>(</b><b>(</b>+2'<b>(</b>''0000000000<b>(</b><b>(</b>2223;55554375'0538574754354:443<b>(</b>'<b>(</b>20<b>(</b>03030<b>(</b>33''0'93333+0<b>(</b>30700.+'+2%%%%%%&lt;%%%%%%%%%%%%%%%%%%%%%%%%%%'<b>(</b>0000'0<b>(</b>6*02%6<b>(</b>,/<b>(</b><b>(</b><b>(</b>10'<b>(</b><b>(</b><b>)</b>08883555555&lt;54444''''5577777275555443000000900000''''3333333/33333030"<b>)</b><b>)</b></span>
<span id='line43'>      register<b>(</b>acc, make<b>(</b>"normal 300 Roboto",967,211,<b>[</b>0,170,191,195,210,217,223,226,228,240,246,266,281,287,321,326,331,336,361,378,397,416,427,432,442,453,456,459,475,481,486,490,506,511,516,518,523,530,536,545,550,554,556,558,562,564,569,571,582,586,593,598,599,605,613,616,617,625,631,635,649,657,669,677,685,710,725,739,756,776,802,846,865,886,896,913,1000<b>]</b>,"/,2UNh\\&amp;34;R'2.9NNNNNNNNNN<b>)</b><b>(</b>FNH?p^<b>[</b>abSQef0M_Jmfd\\d`WXb<b>]</b>o<b>[</b>YX.9.:&lt;2KNGOH5OM,-D,nMQNP6E3MBiCAC5+5e%%%%%%q%%%%%%%%%%%%%%%%%%%%%%%%%%/+LTgG*Z&lt;k=?L%k;8J771PA//7>>gij@^^^^^^paSSSS0000cfdddddIdbbbbYWVKKKKKKlGHHHH++++UMQQQQQSPMMMMAQA"<b>)</b><b>)</b></span>
<span id='line44'>      register<b>(</b>acc, make<b>(</b>"normal 400 Roboto",967,211,<b>[</b>0,174,196,211,240,243,247,248,257,263,265,272,276,309,313,320,327,338,342,348,367,374,412,418,431,447,451,458,472,473,484,489,496,508,516,523,525,533,534,538,547,551,553,554,562,566,568,571,576,581,586,593,597,601,616,623,627,631,636,651,652,656,670,681,687,713,732,751,778,786,844,876,887,898,935,1000<b>]</b>,",-4<b>[</b>Qg\\&amp;78=S'1.;QQQQQQQQQQ*<b>(</b>FNHAna\\`bSOdf0O<b>]</b>Llfe^e<b>[</b>XY`_m<b>]</b>ZZ/;/&lt;?2MQHRJ8QN*<b>)</b>F*lOTQS6G5NChEBE6+6d%%%%%%p%%%%%%%%%%%%%%%%%%%%%%%%%%,+MVfI<b>)</b><b>[</b>&lt;j>AP%j@:K993RD.,9@AgiiBaaaaaao`SSSS0000cfeeeeeJe````ZXYMMMMMMkHJJJJ++++WOTTTTTTRNNNNBUB"<b>)</b><b>)</b></span>
<span id='line45'>      register<b>(</b>acc, make<b>(</b>"normal 500 Roboto",967,211,<b>[</b>0,169,220,238,249,251,258,265,268,274,282,324,328,335,352,354,370,380,396,418,427,442,446,451,457,485,487,491,495,503,508,516,522,523,533,537,541,549,555,557,561,564,566,568,571,574,582,591,602,607,610,613,624,631,633,639,647,653,666,668,681,690,702,710,727,734,743,771,783,792,844,870,875,880,895,940,1000<b>]</b>,"<b>)</b>-0WPf\\&amp;34:L'1/7PPPPPPPPPP,<b>(</b>CME?o_Z^^OJad/KZImdb\\bYVV^<b>]</b>n<b>[</b>WU.8.9&lt;0INFNH4PK+*E+lLQNP3D2LAgB?B2*2_%%%%%%q%%%%%%%%%%%%%%%%%%%%%%%%%%<b>)</b>,MTcG<b>)</b>Y:i;>K%i>6H551T@/+5=>ehj?______p^OOOO////`dbbbbbGb^^^^WUXIIIIIIkFHHHH,,,,SLQQQQQQOLLLL?R?"<b>)</b><b>)</b></span>
<span id='line46'>      register<b>(</b>acc, make<b>(</b>"normal 700 Roboto",967,211,<b>[</b>0,162,244,252,253,262,268,274,278,282,292,301,321,331,332,338,353,358,365,374,388,422,437,446,453,457,467,490,500,502,505,509,517,521,534,537,542,548,551,560,563,565,570,572,575,596,608,616,619,631,638,648,650,656,658,665,673,681,690,692,707,718,738,761,784,808,844,866,876,895,940,1000<b>]</b>,"<b>(</b>,1RQcZ&amp;55=J'9/8QQQQQQQQQQ.*DPEAj<b>]</b>WZYMJ^a/LWIia_X_WTU<b>[</b>ZiWUS-:-;&lt;2HMFMI6PL+*G+hLNMN7E4LCcDBD2<b>)</b>2X%%%%%%l%%%%%%%%%%%%%%%%%%%%%%%%%%<b>(</b>.QR`H<b>(</b>V?e&lt;AK%eB9H883T@0+8>AbdfA<b>]</b><b>]</b><b>]</b><b>]</b><b>]</b><b>]</b>kZMMMM////\\a_____G_<b>[</b><b>[</b><b>[</b><b>[</b>USVHHHHHHgFIIII,,,,QLNNNNNONLLLLBOB"<b>)</b><b>)</b></span>
<span id='line47'>      register<b>(</b>acc, make<b>(</b>"normal 400 Times",750,250,<b>[</b>0,180,200,250,278,300,310,333,389,400,408,444,453,469,480,500,541,549,556,564,576,611,667,722,750,760,778,833,889,921,944,1000<b>]</b>,"<b>(</b>,/44@?&amp;,,48<b>(</b>,<b>(</b><b>)</b>4444444444<b>)</b><b>)</b>8880B&lt;;;&lt;:7&lt;&lt;,-&lt;:A&lt;&lt;7&lt;;7:&lt;&lt;C&lt;&lt;:,<b>)</b>,24,04040,44<b>)</b><b>)</b>4<b>)</b>?4444,-<b>)</b>44&lt;4403'35%%%%%%D%%%%%%%%%%%%%%%%%%%%%%%%%%<b>(</b>,4444'4,><b>)</b>48%>,.6**,91<b>(</b>,*+4===0&lt;&lt;&lt;&lt;&lt;&lt;A;::::,,,,&lt;&lt;&lt;&lt;&lt;&lt;&lt;8&lt;&lt;&lt;&lt;&lt;&lt;74000000;00000<b>)</b><b>)</b><b>)</b><b>)</b>4444444644444444"<b>)</b><b>)</b></span>
<span id='line48'>      register<b>(</b>acc, make<b>(</b>"normal 700 Times",750,250,<b>[</b>0,220,250,278,300,333,389,394,400,444,500,520,540,549,556,570,576,581,611,667,722,750,778,833,930,944,1000<b>]</b>,"'*3//?&lt;<b>(</b>**/4'*'<b>(</b>//////////**444/=989987;;+/;8>9;7;93899?998*<b>(</b>*6/*/3.3.*/3<b>(</b>*3<b>(</b>&lt;3/33.+*3/9//.,&amp;,0%%%%%%?%%%%%%%%%%%%%%%%%%%%%%%%%%'*////&amp;/*:<b>)</b>/4%:*-2<b>)</b><b>)</b>*51'*<b>)</b>*/:::/999999?98888++++99;;;;;4;9999973//////9.....<b>(</b><b>(</b><b>(</b><b>(</b>/3/////2/3333/3/"<b>)</b><b>)</b></span>
<span id='line49'>      register<b>(</b>acc, make<b>(</b>"italic 400 Times",750,250,<b>[</b>0,214,250,276,278,300,310,333,389,400,422,444,500,523,541,549,556,576,611,667,675,722,750,760,778,833,889,920,1000<b>]</b>,"',/11>=&amp;,,19','<b>)</b>1111111111,,9991@778:77::,085>8:7:715:7>755-<b>)</b>-/1,11010<b>)</b>11<b>)</b><b>)</b>0<b>)</b>:1111--<b>)</b>10800-.<b>(</b>.3%%%%%%A%%%%%%%%%%%%%%%%%%%%%%%%%%'-1111<b>(</b>1,&lt;<b>(</b>19%&lt;,.4**,62',*+1;;;1777777?87777,,,,:8:::::9:::::571111111800000<b>)</b><b>)</b><b>)</b><b>)</b>1111111411111010"<b>)</b><b>)</b></span>
<span id='line50'>      register<b>(</b>acc, make<b>(</b>"italic 700 Times",750,250,<b>[</b>0,220,250,266,278,300,333,348,389,395,400,444,485,500,549,556,570,576,606,611,667,722,750,778,833,889,944,1000<b>]</b>,"'-422=&lt;<b>)</b>++25'+'<b>)</b>2222222222++5552=999:99:&lt;-298>::8:948:9>988+<b>)</b>+52+22020+24<b>)</b><b>)</b>2<b>)</b>&lt;4222--<b>)</b>40920-,&amp;,5%%%%%%@%%%%%%%%%%%%%%%%%%%%%%%%%%'-2222&amp;2+;<b>(</b>27%;+/3**+62'+**2;;;2999999?99999----:::::::5:::::882222222:00001<b>)</b><b>)</b><b>)</b>.2422222324444020"<b>)</b><b>)</b></span>
<span id='line51'>      register<b>(</b>acc, make<b>(</b>"normal 400 Courier",754,247,<b>[</b>0,400,549,576,600,1000<b>]</b>,"<b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b>%%%%%%*%%%%%%%%%%%%%%%%%%%%%%%%%%<b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b>%<b>)</b><b>)</b>&amp;'<b>)</b><b>)</b><b>)</b><b>(</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b>'<b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b>"<b>)</b><b>)</b></span>
<span id='line52'>      register<b>(</b>acc, make<b>(</b>"normal 700 Courier",754,247,<b>[</b>0,400,549,576,600,1000<b>]</b>,"<b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b>%%%%%%*%%%%%%%%%%%%%%%%%%%%%%%%%%<b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b>%<b>)</b><b>)</b>&amp;'<b>)</b><b>)</b><b>)</b><b>(</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b>'<b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b>"<b>)</b><b>)</b></span>
<span id='line53'>      register<b>(</b>acc, make<b>(</b>"italic 400 Courier",754,247,<b>[</b>0,400,549,576,600,1000<b>]</b>,"<b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b>%%%%%%*%%%%%%%%%%%%%%%%%%%%%%%%%%<b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b>%<b>)</b><b>)</b>&amp;'<b>)</b><b>)</b><b>)</b><b>(</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b>'<b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b>"<b>)</b><b>)</b></span>
<span id='line54'>      register<b>(</b>acc, make<b>(</b>"italic 700 Courier",754,247,<b>[</b>0,400,549,576,600,1000<b>]</b>,"<b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b>%%%%%%*%%%%%%%%%%%%%%%%%%%%%%%%%%<b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b>%<b>)</b><b>)</b>&amp;'<b>)</b><b>)</b><b>)</b><b>(</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b>'<b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b><b>)</b>"<b>)</b><b>)</b></span>
<span id='line55'>      register<b>(</b>acc, make<b>(</b>"normal 400 Roboto-Mono",967,211,<b>[</b>0,601,615,1000<b>]</b>,"&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;%%%%%%<b>(</b>%%%%%%%%%%%%%%%%%%%%%%%%%%&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;%&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;'&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;"<b>)</b><b>)</b></span>
<span id='line56'>    <b>}</b></span>
<span id='line57'>    catch <b>(</b>Err e<b>)</b> e.trace</span>
<span id='line58'>    registry = acc</span>
<span id='line59'>  <b>}</b></span>
<span id='line60'></span>
<span id='line61'>  ** Used by static initializer</span>
<span id='line62'>  private static Void register<b>(</b><b>[</b>Str:FontData<b>]</b> acc, FontData m<b>)</b></span>
<span id='line63'>  <b>{</b></span>
<span id='line64'>    acc<b>[</b>m.key<b>]</b> = m</span>
<span id='line65'>  <b>}</b></span>
<span id='line66'></span>
<span id='line67'>  ** Map to registry key string</span>
<span id='line68'>  private static Str toKey<b>(</b>FontStyle style, FontWeight weight, Str name<b>)</b></span>
<span id='line69'>  <b>{</b></span>
<span id='line70'>    "$style $weight.num $name"</span>
<span id='line71'>  <b>}</b></span>
<span id='line72'></span>
<span id='line73'>  ** Constructor used by auto-generated FontRegistry</span>
<span id='line74'>  private new make<b>(</b>Str key, Int ascent, Int descent, Int<b>[</b><b>]</b> widths, Str charToWidth<b>)</b></span>
<span id='line75'>  <b>{</b></span>
<span id='line76'>    toks := key.split</span>
<span id='line77'></span>
<span id='line78'>    this.style   = FontStyle.decode<b>(</b>toks<b>[</b>0<b>]</b><b>)</b></span>
<span id='line79'>    this.weight  = FontWeight.decode<b>(</b>toks<b>[</b>1<b>]</b><b>)</b></span>
<span id='line80'>    this.name    = toks<b>[</b>2<b>]</b>.replace<b>(</b>"-", " "<b>)</b></span>
<span id='line81'>    this.key     = toKey<b>(</b>style, weight, name<b>)</b></span>
<span id='line82'>    this.ascent  = ascent</span>
<span id='line83'>    this.descent = descent</span>
<span id='line84'>    this.leading = descent</span>
<span id='line85'>    this.height  = leading + ascent + descent</span>
<span id='line86'>    this.widths  = widths</span>
<span id='line87'>    this.charToWidth = charToWidth</span>
<span id='line88'>    this.lastChar = charToWidth.size + 32</span>
<span id='line89'>  <b>}</b></span>
<span id='line90'></span>
<span id='line91'>//////////////////////////////////////////////////////////////////////////</span>
<span id='line92'>// Normalize</span>
<span id='line93'>//////////////////////////////////////////////////////////////////////////</span>
<span id='line94'></span>
<span id='line95'>  ** Return best match for normalized font</span>
<span id='line96'>  static Font normalize<b>(</b>Font f<b>)</b></span>
<span id='line97'>  <b>{</b></span>
<span id='line98'>    // try to normalize by each name in prioritized list of names</span>
<span id='line99'>    FontData? m := null</span>
<span id='line100'>    for <b>(</b>i := 0; i&lt;f.names.size; ++i<b>)</b></span>
<span id='line101'>    <b>{</b></span>
<span id='line102'>      m = toNormalize<b>(</b>f.style, f.weight, f.names<b>[</b>i<b>]</b><b>)</b></span>
<span id='line103'>      if <b>(</b>m != null<b>)</b> break</span>
<span id='line104'>    <b>}</b></span>
<span id='line105'></span>
<span id='line106'>    // fallback</span>
<span id='line107'>    if <b>(</b>m == null<b>)</b> m = registry.getChecked<b>(</b>"normal 400 Helvetica"<b>)</b></span>
<span id='line108'></span>
<span id='line109'>    // map metrics back to Font instance with proper size</span>
<span id='line110'>    return Font.makeFields<b>(</b><b>[</b>m.name<b>]</b>, f.size, m.weight, m.style<b>)</b></span>
<span id='line111'>  <b>}</b></span>
<span id='line112'></span>
<span id='line113'>  private static FontData? toNormalize<b>(</b>FontStyle style, FontWeight weight, Str name<b>)</b></span>
<span id='line114'>  <b>{</b></span>
<span id='line115'>    // first find exact match</span>
<span id='line116'>    m := registry<b>[</b>toKey<b>(</b>style, weight, name<b>)</b><b>]</b></span>
<span id='line117'>    if <b>(</b>m != null<b>)</b> return m</span>
<span id='line118'></span>
<span id='line119'>    // normalize weight</span>
<span id='line120'>    if <b>(</b>weight.num &lt; 400<b>)</b> weight = FontWeight.normal</span>
<span id='line121'>    else if <b>(</b>weight.num > 400<b>)</b> weight = FontWeight.bold</span>
<span id='line122'>    m = registry<b>[</b>toKey<b>(</b>style, weight, name<b>)</b><b>]</b></span>
<span id='line123'>    if <b>(</b>m != null<b>)</b> return m</span>
<span id='line124'></span>
<span id='line125'>    // next check oblique as italic</span>
<span id='line126'>    if <b>(</b>style == FontStyle.oblique<b>)</b></span>
<span id='line127'>    <b>{</b></span>
<span id='line128'>      m = registry<b>[</b>toKey<b>(</b>FontStyle.italic, weight, name<b>)</b><b>]</b></span>
<span id='line129'>      if <b>(</b>m != null<b>)</b> return m</span>
<span id='line130'>    <b>}</b></span>
<span id='line131'></span>
<span id='line132'>    // try to fallback to no style, normal weight</span>
<span id='line133'>    return registry<b>[</b>toKey<b>(</b>FontStyle.normal, FontWeight.normal, name<b>)</b><b>]</b></span>
<span id='line134'>  <b>}</b></span>
<span id='line135'></span>
<span id='line136'>//////////////////////////////////////////////////////////////////////////</span>
<span id='line137'>// Metrics</span>
<span id='line138'>//////////////////////////////////////////////////////////////////////////</span>
<span id='line139'></span>
<span id='line140'>  ** Key of "&lt;style> &lt;weight> &lt;name>"</span>
<span id='line141'>  const Str key</span>
<span id='line142'></span>
<span id='line143'>  ** Family name</span>
<span id='line144'>  const Str name</span>
<span id='line145'></span>
<span id='line146'>  ** Font weight</span>
<span id='line147'>  const FontWeight weight</span>
<span id='line148'></span>
<span id='line149'>  ** Font style</span>
<span id='line150'>  const FontStyle style</span>
<span id='line151'></span>
<span id='line152'>  ** Height is leading + ascent + descent</span>
<span id='line153'>  const Int height</span>
<span id='line154'></span>
<span id='line155'>  ** Leading normalized to 1000pt</span>
<span id='line156'>  const Int leading</span>
<span id='line157'></span>
<span id='line158'>  ** Ascent normalized to 1000pt</span>
<span id='line159'>  const Int ascent</span>
<span id='line160'></span>
<span id='line161'>  ** Descent normalized to 1000pt</span>
<span id='line162'>  const Int descent</span>
<span id='line163'></span>
<span id='line164'>  ** Widths table</span>
<span id='line165'>  const Int<b>[</b><b>]</b> widths</span>
<span id='line166'></span>
<span id='line167'>  ** ASCII map of char to index into widths</span>
<span id='line168'>  private const Str charToWidth</span>
<span id='line169'></span>
<span id='line170'>  ** Last unicode char we have metrics for</span>
<span id='line171'>  const Int lastChar</span>
<span id='line172'></span>
<span id='line173'>  ** Character width normalized to 1000pts</span>
<span id='line174'>  Int charWidth<b>(</b>Int ch<b>)</b></span>
<span id='line175'>  <b>{</b></span>
<span id='line176'>    // control chars</span>
<span id='line177'>    if <b>(</b>ch &lt; 32<b>)</b> return 0</span>
<span id='line178'></span>
<span id='line179'>    // mapped char</span>
<span id='line180'>    if <b>(</b>ch &lt; lastChar<b>)</b></span>
<span id='line181'>    <b>{</b></span>
<span id='line182'>      index := charToWidth<b>[</b>ch - 32<b>]</b> - 37</span>
<span id='line183'>      return widths<b>[</b>index<b>]</b></span>
<span id='line184'>    <b>}</b></span>
<span id='line185'></span>
<span id='line186'>    // bullet</span>
<span id='line187'>    if <b>(</b>ch == 0x2022<b>)</b> return charWidth<b>(</b>'*'<b>)</b></span>
<span id='line188'></span>
<span id='line189'>    // subscripts to superscript 2</span>
<span id='line190'>    if <b>(</b>0x2080 &lt;= ch &amp;&amp; ch &lt;= 0x2089<b>)</b> return charWidth<b>(</b>'\u00B3'<b>)</b></span>
<span id='line191'></span>
<span id='line192'>    // fallback to width of lowercase m</span>
<span id='line193'>    return charWidth<b>(</b>'m'<b>)</b></span>
<span id='line194'>  <b>}</b></span>
<span id='line195'></span>
<span id='line196'><b>}</b></span>
</pre>
</div>
</body>
</html>
