<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
 "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns='http://www.w3.org/1999/xhtml'>
<head>
<title>Tree.fan</title>
<meta http-equiv='Content-Type' content='text/html; charset=UTF-8'/>
<link rel='stylesheet' type='text/css' href='../style.css' />
</head>
<body>
<div class='breadcrumb'>
<ul>
<li><a href='../index.html'>Doc Index</a></li><li><a href='index.html'>domkit</a></li><li><a href='Tree.html'>Tree</a></li><li><a href='src-Tree.fan.html'>Tree.fan</a></li></ul>
</div>
<div class='src'>
<pre>
<span id='line1'>//</span>
<span id='line2'>// Copyright <b>(</b>c<b>)</b> 2015, Brian Frank and Andy Frank</span>
<span id='line3'>// Licensed under the Academic Free License version 3.0</span>
<span id='line4'>//</span>
<span id='line5'>// History:</span>
<span id='line6'>//   19 Mar 2015  Andy Frank  Creation</span>
<span id='line7'>//</span>
<span id='line8'></span>
<span id='line9'>using dom</span>
<span id='line10'>using graphics</span>
<span id='line11'></span>
<span id='line12'>**************************************************************************</span>
<span id='line13'>** TreeNode</span>
<span id='line14'>**************************************************************************</span>
<span id='line15'></span>
<span id='line16'>**</span>
<span id='line17'>** TreeNode models a node in a Tree.</span>
<span id='line18'>**</span>
<span id='line19'>** See also: <b>[</b>docDomkit<b>]</b>`docDomkit::Controls#tree`</span>
<span id='line20'>**</span>
<span id='line21'>@Js abstract class TreeNode</span>
<span id='line22'><b>{</b></span>
<span id='line23'>  ** Parent node of this node, or 'null' if this node is a root.</span>
<span id='line24'>  TreeNode? parent <b>{</b> internal set <b>}</b></span>
<span id='line25'></span>
<span id='line26'>  ** Is this node expanded?</span>
<span id='line27'>  Bool isExpanded<b>(</b><b>)</b> <b>{</b> expanded <b>}</b></span>
<span id='line28'></span>
<span id='line29'>  ** Return true if this has or might have children. This</span>
<span id='line30'>  ** is an optimization to display an expansion control</span>
<span id='line31'>  ** without actually loading all the children.  The</span>
<span id='line32'>  ** default returns '!children.isEmpty'.</span>
<span id='line33'>  virtual Bool hasChildren<b>(</b><b>)</b> <b>{</b> !children.isEmpty <b>}</b></span>
<span id='line34'></span>
<span id='line35'>  ** Get the children of this node.  If no children return</span>
<span id='line36'>  ** an empty list. Default behavior is no children. This</span>
<span id='line37'>  ** method must return the same instances when called.</span>
<span id='line38'>  virtual TreeNode<b>[</b><b>]</b> children<b>(</b><b>)</b> <b>{</b> List.defVal <b>}</b></span>
<span id='line39'></span>
<span id='line40'>  ** Callback to customize Elem for this node.</span>
<span id='line41'>  abstract Void onElem<b>(</b>Elem elem, TreeFlags flags<b>)</b></span>
<span id='line42'></span>
<span id='line43'>  internal Int? depth</span>
<span id='line44'>  internal Elem? elem</span>
<span id='line45'>  internal Bool expanded := false</span>
<span id='line46'><b>}</b></span>
<span id='line47'></span>
<span id='line48'>**************************************************************************</span>
<span id='line49'>** TreeFlags</span>
<span id='line50'>**************************************************************************</span>
<span id='line51'></span>
<span id='line52'>** Tree specific flags for eventing</span>
<span id='line53'>@Js const class TreeFlags</span>
<span id='line54'><b>{</b></span>
<span id='line55'>  new make<b>(</b>|This| f<b>)</b> <b>{</b> f<b>(</b>this<b>)</b> <b>}</b></span>
<span id='line56'></span>
<span id='line57'>  ** Tree has focus.</span>
<span id='line58'>  const Bool focused</span>
<span id='line59'></span>
<span id='line60'>  ** Node is selected.</span>
<span id='line61'>  const Bool selected</span>
<span id='line62'></span>
<span id='line63'>  override Str toStr<b>(</b><b>)</b></span>
<span id='line64'>  <b>{</b></span>
<span id='line65'>    "TreeFlags <b>{</b> focused=$focused; selected=$selected <b>}</b>"</span>
<span id='line66'>  <b>}</b></span>
<span id='line67'><b>}</b></span>
<span id='line68'></span>
<span id='line69'>**************************************************************************</span>
<span id='line70'>** TreeEvent</span>
<span id='line71'>**************************************************************************</span>
<span id='line72'></span>
<span id='line73'>**</span>
<span id='line74'>** TreeEvent are generated by `TreeNode` nodes.</span>
<span id='line75'>**</span>
<span id='line76'>@Js class TreeEvent</span>
<span id='line77'><b>{</b></span>
<span id='line78'>  internal new make<b>(</b>Tree t, TreeNode n, |This| f<b>)</b></span>
<span id='line79'>  <b>{</b></span>
<span id='line80'>    this.tree = t</span>
<span id='line81'>    this.node = n</span>
<span id='line82'>    f<b>(</b>this<b>)</b></span>
<span id='line83'>  <b>}</b></span>
<span id='line84'></span>
<span id='line85'>  ** Parent `Tree` instance.</span>
<span id='line86'>  Tree tree <b>{</b> private set <b>}</b></span>
<span id='line87'></span>
<span id='line88'>  ** `TreeNode` this event was trigged on.</span>
<span id='line89'>  TreeNode node <b>{</b> private set <b>}</b></span>
<span id='line90'></span>
<span id='line91'>  ** Event type.</span>
<span id='line92'>  const Str type</span>
<span id='line93'></span>
<span id='line94'>  ** Mouse position relative to page.</span>
<span id='line95'>  const Point pagePos</span>
<span id='line96'></span>
<span id='line97'>  ** Mouse position relative to node.</span>
<span id='line98'>  const Point nodePos</span>
<span id='line99'></span>
<span id='line100'>  ** Size of node for this event.</span>
<span id='line101'>  const Size size</span>
<span id='line102'></span>
<span id='line103'>  override Str toStr<b>(</b><b>)</b></span>
<span id='line104'>  <b>{</b></span>
<span id='line105'>    "TreeNode <b>{</b> node=$node type=$type pagePos=$pagePos nodePos=$nodePos size=$size <b>}</b>"</span>
<span id='line106'>  <b>}</b></span>
<span id='line107'><b>}</b></span>
<span id='line108'></span>
<span id='line109'>**************************************************************************</span>
<span id='line110'>** Tree</span>
<span id='line111'>**************************************************************************</span>
<span id='line112'></span>
<span id='line113'>**</span>
<span id='line114'>** Tree visualizes <b>[</b>TreeNodes<b>]</b>`TreeNode` as a series of expandable nodes.</span>
<span id='line115'>**</span>
<span id='line116'>** See also: <b>[</b>docDomkit<b>]</b>`docDomkit::Controls#tree`</span>
<span id='line117'>**</span>
<span id='line118'>@Js class Tree : Box</span>
<span id='line119'><b>{</b></span>
<span id='line120'>  ** Constructor.</span>
<span id='line121'>  new make<b>(</b><b>)</b> : super<b>(</b><b>)</b></span>
<span id='line122'>  <b>{</b></span>
<span id='line123'>    this.sel = TreeSelection<b>(</b>this<b>)</b></span>
<span id='line124'>    this->tabIndex = 0</span>
<span id='line125'>    this.style.addClass<b>(</b>"domkit-Tree domkit-border"<b>)</b></span>
<span id='line126'></span>
<span id='line127'>    this.onEvent<b>(</b>"mousedown", false<b>)</b> |e| <b>{</b> onMouseEvent<b>(</b>e<b>)</b> <b>}</b></span>
<span id='line128'>    this.onEvent<b>(</b>"mouseup",   false<b>)</b> |e| <b>{</b> onMouseEvent<b>(</b>e<b>)</b> <b>}</b></span>
<span id='line129'>    this.onEvent<b>(</b>"dblclick",  false<b>)</b> |e| <b>{</b> onMouseEvent<b>(</b>e<b>)</b> <b>}</b></span>
<span id='line130'></span>
<span id='line131'>    // manually track focus so we can detect when</span>
<span id='line132'>    // the browser window becomes unactive while</span>
<span id='line133'>    // maintaining focus internally in document</span>
<span id='line134'>    this.onEvent<b>(</b>"focus", false<b>)</b> |e| <b>{</b> manFocus=true;  refresh <b>}</b></span>
<span id='line135'>    this.onEvent<b>(</b>"blur",  false<b>)</b> |e| <b>{</b> manFocus=false; refresh <b>}</b></span>
<span id='line136'>  <b>}</b></span>
<span id='line137'></span>
<span id='line138'>  ** Root nodes for this tree.</span>
<span id='line139'>  TreeNode<b>[</b><b>]</b> roots := <b>[</b>,<b>]</b></span>
<span id='line140'></span>
<span id='line141'>  ** Rebuild tree layout.</span>
<span id='line142'>  Void rebuild<b>(</b><b>)</b></span>
<span id='line143'>  <b>{</b></span>
<span id='line144'>    if <b>(</b>this.size.w > 0f<b>)</b> doRebuild</span>
<span id='line145'>    else Win.cur.setTimeout<b>(</b>16ms<b>)</b> |->| <b>{</b> rebuild <b>}</b></span>
<span id='line146'>  <b>}</b></span>
<span id='line147'></span>
<span id='line148'>  ** Refresh tree content.</span>
<span id='line149'>  Void refresh<b>(</b><b>)</b></span>
<span id='line150'>  <b>{</b></span>
<span id='line151'>    roots.each |r| <b>{</b> refreshNode<b>(</b>r<b>)</b> <b>}</b></span>
<span id='line152'>  <b>}</b></span>
<span id='line153'></span>
<span id='line154'>  ** Refresh given node.</span>
<span id='line155'>  Void refreshNode<b>(</b>TreeNode node<b>)</b></span>
<span id='line156'>  <b>{</b></span>
<span id='line157'>    doRefreshNode<b>(</b>node<b>)</b></span>
<span id='line158'>  <b>}</b></span>
<span id='line159'></span>
<span id='line160'>  ** Set expanded state for given node.</span>
<span id='line161'>  Void expand<b>(</b>TreeNode node, Bool expanded<b>)</b></span>
<span id='line162'>  <b>{</b></span>
<span id='line163'>    // short-cirucit if no-op</span>
<span id='line164'>    if <b>(</b>node.expanded == expanded<b>)</b> return</span>
<span id='line165'></span>
<span id='line166'>    node.expanded = expanded</span>
<span id='line167'>    refreshNode<b>(</b>node<b>)</b></span>
<span id='line168'>  <b>}</b></span>
<span id='line169'></span>
<span id='line170'>  ** Experimental hook to modify the node display state.</span>
<span id='line171'>  @NoDoc Void displayState<b>(</b>TreeNode node, Str? state<b>)</b></span>
<span id='line172'>  <b>{</b></span>
<span id='line173'>    // remove existing state</span>
<span id='line174'>    content := node.elem.querySelector<b>(</b>".domkit-Tree-node"<b>)</b></span>
<span id='line175'>    content.style.removeClass<b>(</b>"down"<b>)</b></span>
<span id='line176'></span>
<span id='line177'>    // add new state</span>
<span id='line178'>    if <b>(</b>state == "down"<b>)</b> content.style.addClass<b>(</b>"down"<b>)</b></span>
<span id='line179'>  <b>}</b></span>
<span id='line180'></span>
<span id='line181'>  ** Selection for tree. Index based selection is not supported for Tree.</span>
<span id='line182'>  Selection sel <b>{</b> private set <b>}</b></span>
<span id='line183'></span>
<span id='line184'>  ** Callback when selection changes.</span>
<span id='line185'>  Void onSelect<b>(</b>|This| f<b>)</b> <b>{</b> cbSelect = f <b>}</b></span>
<span id='line186'></span>
<span id='line187'>  ** Callback when a node has been double clicked.</span>
<span id='line188'>  Void onAction<b>(</b>|Tree, Event| f<b>)</b> <b>{</b> cbAction = f <b>}</b></span>
<span id='line189'></span>
<span id='line190'>  ** Callback when a event occurs inside a tree node.</span>
<span id='line191'>  Void onTreeEvent<b>(</b>Str type, |TreeEvent| f<b>)</b> <b>{</b> cbTreeEvent<b>[</b>type<b>]</b> = f <b>}</b></span>
<span id='line192'></span>
<span id='line193'>//////////////////////////////////////////////////////////////////////////</span>
<span id='line194'>// Layout</span>
<span id='line195'>//////////////////////////////////////////////////////////////////////////</span>
<span id='line196'></span>
<span id='line197'>  private Void doRebuild<b>(</b><b>)</b></span>
<span id='line198'>  <b>{</b></span>
<span id='line199'>    removeAll</span>
<span id='line200'>    roots.each |r| <b>{</b> add<b>(</b>toElem<b>(</b>null, r<b>)</b><b>)</b> <b>}</b></span>
<span id='line201'>  <b>}</b></span>
<span id='line202'></span>
<span id='line203'>  private Void doRefreshNode<b>(</b>TreeNode node<b>)</b></span>
<span id='line204'>  <b>{</b></span>
<span id='line205'>    // TODO: how does this work?</span>
<span id='line206'>    if <b>(</b>node.elem == null<b>)</b> return</span>
<span id='line207'></span>
<span id='line208'>    // update css</span>
<span id='line209'>    node.elem.style.toggleClass<b>(</b>"expanded", node.expanded<b>)</b></span>
<span id='line210'></span>
<span id='line211'>    // set expander icon</span>
<span id='line212'>    expander := node.elem.querySelector<b>(</b>".domkit-Tree-node-expander"<b>)</b></span>
<span id='line213'>    expander.style->left = "$<b>{</b>node.depth * depthIndent<b>}</b>px"</span>
<span id='line214'>    expander.html = node.hasChildren ? "\u25ba" : "&amp;nbsp;"</span>
<span id='line215'></span>
<span id='line216'>    // remove existing children</span>
<span id='line217'>    while <b>(</b>node.elem.children.size > 1<b>)</b></span>
<span id='line218'>      node.elem.remove<b>(</b>node.elem.lastChild<b>)</b></span>
<span id='line219'></span>
<span id='line220'>    // update selection</span>
<span id='line221'>    selected := sel.items.contains<b>(</b>node<b>)</b></span>
<span id='line222'>    content  := node.elem.querySelector<b>(</b>".domkit-Tree-node"<b>)</b></span>
<span id='line223'>    content.style.toggleClass<b>(</b>"domkit-sel", selected<b>)</b></span>
<span id='line224'></span>
<span id='line225'>    // update content</span>
<span id='line226'>    flags := TreeFlags</span>
<span id='line227'>    <b>{</b></span>
<span id='line228'>      it.focused  = manFocus</span>
<span id='line229'>      it.selected = selected</span>
<span id='line230'>    <b>}</b></span>
<span id='line231'>    content.style->paddingLeft = "$<b>{</b><b>(</b>node.depth+1<b>)</b> * depthIndent<b>}</b>px"</span>
<span id='line232'>    node.onElem<b>(</b>content.lastChild, flags<b>)</b></span>
<span id='line233'></span>
<span id='line234'>    // add children if expanded</span>
<span id='line235'>    if <b>(</b>node.expanded<b>)</b></span>
<span id='line236'>    <b>{</b></span>
<span id='line237'>      node.children.each |k|</span>
<span id='line238'>      <b>{</b></span>
<span id='line239'>        k.parent = node</span>
<span id='line240'>        node.elem.add<b>(</b>toElem<b>(</b>node, k<b>)</b><b>)</b></span>
<span id='line241'>        doRefreshNode<b>(</b>k<b>)</b></span>
<span id='line242'>      <b>}</b></span>
<span id='line243'>    <b>}</b></span>
<span id='line244'>  <b>}</b></span>
<span id='line245'></span>
<span id='line246'>  ** Map TreeNode to DOM element.</span>
<span id='line247'>  private Elem toElem<b>(</b>TreeNode? parent, TreeNode node<b>)</b></span>
<span id='line248'>  <b>{</b></span>
<span id='line249'>    if <b>(</b>node.elem == null<b>)</b></span>
<span id='line250'>    <b>{</b></span>
<span id='line251'>      node.depth = parent==null ? 0 : parent.depth+1</span>
<span id='line252'>      node.elem = Elem</span>
<span id='line253'>      <b>{</b></span>
<span id='line254'>        it.style.addClass<b>(</b>"domkit-Tree-node-block"<b>)</b></span>
<span id='line255'>        Elem <b>{</b></span>
<span id='line256'>          it.style.addClass<b>(</b>"domkit-Tree-node"<b>)</b></span>
<span id='line257'>          Elem <b>{</b> it.style.addClass<b>(</b>"domkit-Tree-node-expander"<b>)</b> <b>}</b>,</span>
<span id='line258'>          Elem <b>{</b><b>}</b>,</span>
<span id='line259'>        <b>}</b>,</span>
<span id='line260'>      <b>}</b></span>
<span id='line261'>      refreshNode<b>(</b>node<b>)</b></span>
<span id='line262'>    <b>}</b></span>
<span id='line263'>    return node.elem</span>
<span id='line264'>  <b>}</b></span>
<span id='line265'></span>
<span id='line266'>  ** Map DOM element to TreeNode.</span>
<span id='line267'>  private TreeNode toNode<b>(</b>Elem elem<b>)</b></span>
<span id='line268'>  <b>{</b></span>
<span id='line269'>    // bubble to block elem</span>
<span id='line270'>    while <b>(</b>!elem.style.hasClass<b>(</b>"domkit-Tree-node-block"<b>)</b><b>)</b> elem = elem.parent</span>
<span id='line271'></span>
<span id='line272'>    // find dom path</span>
<span id='line273'>    elemPath := Elem<b>[</b>elem<b>]</b></span>
<span id='line274'>    while <b>(</b>!elemPath.first.parent.style.hasClass<b>(</b>"domkit-Tree"<b>)</b><b>)</b></span>
<span id='line275'>      elemPath.insert<b>(</b>0, elemPath.first.parent<b>)</b></span>
<span id='line276'></span>
<span id='line277'>    // walk path from roots</span>
<span id='line278'>    TreeNode? node</span>
<span id='line279'>    elemPath.each |p|</span>
<span id='line280'>    <b>{</b></span>
<span id='line281'>      i := p.parent.children.findIndex |k| <b>{</b> p == k <b>}</b></span>
<span id='line282'>      node = node==null ? roots<b>[</b>i<b>]</b> : node.children<b>[</b>i-1<b>]</b></span>
<span id='line283'>    <b>}</b></span>
<span id='line284'></span>
<span id='line285'>    return node</span>
<span id='line286'>  <b>}</b></span>
<span id='line287'></span>
<span id='line288'>//////////////////////////////////////////////////////////////////////////</span>
<span id='line289'>// Eventing</span>
<span id='line290'>//////////////////////////////////////////////////////////////////////////</span>
<span id='line291'></span>
<span id='line292'>  private Void onMouseEvent<b>(</b>Event e<b>)</b></span>
<span id='line293'>  <b>{</b></span>
<span id='line294'>    elem := e.target</span>
<span id='line295'>    if <b>(</b>elem == this<b>)</b> return</span>
<span id='line296'>    node := toNode<b>(</b>elem<b>)</b></span>
<span id='line297'></span>
<span id='line298'>    // check sel/expand</span>
<span id='line299'>    if <b>(</b>e.type == "mousedown"<b>)</b></span>
<span id='line300'>    <b>{</b></span>
<span id='line301'>      // update selection</span>
<span id='line302'>      if <b>(</b>!elem.style.hasClass<b>(</b>"domkit-Tree-node-expander"<b>)</b> &amp;&amp; !sel.items.contains<b>(</b>node<b>)</b><b>)</b></span>
<span id='line303'>      <b>{</b></span>
<span id='line304'>        sel.item = node</span>
<span id='line305'>        cbSelect?.call<b>(</b>this<b>)</b></span>
<span id='line306'>      <b>}</b></span>
<span id='line307'>    <b>}</b></span>
<span id='line308'>    else if <b>(</b>e.type == "mouseup"<b>)</b></span>
<span id='line309'>    <b>{</b></span>
<span id='line310'>      // expand node</span>
<span id='line311'>      if <b>(</b>elem.style.hasClass<b>(</b>"domkit-Tree-node-expander"<b>)</b><b>)</b></span>
<span id='line312'>        expand<b>(</b>node, !node.expanded<b>)</b></span>
<span id='line313'>    <b>}</b></span>
<span id='line314'></span>
<span id='line315'>    // check action</span>
<span id='line316'>    if <b>(</b>e.type == "dblclick" &amp;&amp; !elem.style.hasClass<b>(</b>"domkit-Tree-node-expander"<b>)</b><b>)</b></span>
<span id='line317'>      cbAction?.call<b>(</b>this, e<b>)</b></span>
<span id='line318'></span>
<span id='line319'>    // delegate to cell handlers</span>
<span id='line320'>    cb := cbTreeEvent<b>[</b>e.type<b>]</b></span>
<span id='line321'>    if <b>(</b>cb != null<b>)</b></span>
<span id='line322'>    <b>{</b></span>
<span id='line323'>      blockElem := node.elem</span>
<span id='line324'>      nodeElem  := blockElem.firstChild</span>
<span id='line325'>      indent    := <b>(</b>node.depth + 1<b>)</b> * depthIndent</span>
<span id='line326'>      npos      := nodeElem.relPos<b>(</b>e.pagePos<b>)</b></span>
<span id='line327'></span>
<span id='line328'>      // outside of content</span>
<span id='line329'>      if <b>(</b>npos.x.toInt - indent &lt; 0<b>)</b> return</span>
<span id='line330'></span>
<span id='line331'>      cb.call<b>(</b>TreeEvent<b>(</b>this, node<b>)</b> <b>{</b></span>
<span id='line332'>        it.type    = e.type</span>
<span id='line333'>        it.pagePos = e.pagePos</span>
<span id='line334'>        it.nodePos = Point<b>(</b>npos.x-indent, npos.y<b>)</b></span>
<span id='line335'>        it.size    = Size<b>(</b>nodeElem.size.w-indent, nodeElem.size.h<b>)</b></span>
<span id='line336'>      <b>}</b><b>)</b></span>
<span id='line337'>    <b>}</b></span>
<span id='line338'>  <b>}</b></span>
<span id='line339'></span>
<span id='line340'>//////////////////////////////////////////////////////////////////////////</span>
<span id='line341'>// Selection</span>
<span id='line342'>//////////////////////////////////////////////////////////////////////////</span>
<span id='line343'></span>
<span id='line344'>  internal Void onUpdateSel<b>(</b>TreeNode<b>[</b><b>]</b> oldNodes, TreeNode<b>[</b><b>]</b> newNodes<b>)</b></span>
<span id='line345'>  <b>{</b></span>
<span id='line346'>    oldNodes.each |n| <b>{</b> refreshNode<b>(</b>n<b>)</b> <b>}</b></span>
<span id='line347'>    newNodes.each |n| <b>{</b> refreshNode<b>(</b>n<b>)</b> <b>}</b></span>
<span id='line348'>  <b>}</b></span>
<span id='line349'></span>
<span id='line350'>//////////////////////////////////////////////////////////////////////////</span>
<span id='line351'>// Fields</span>
<span id='line352'>//////////////////////////////////////////////////////////////////////////</span>
<span id='line353'></span>
<span id='line354'>  private static const Int depthIndent := 16</span>
<span id='line355'></span>
<span id='line356'>  private TreeNode<b>[</b><b>]</b> nodes := <b>[</b>,<b>]</b></span>
<span id='line357'>  private Func? cbSelect</span>
<span id='line358'>  private Func? cbAction</span>
<span id='line359'>  private Str:Func cbTreeEvent := <b>[</b>:<b>]</b></span>
<span id='line360'></span>
<span id='line361'>  // focus/blur</span>
<span id='line362'>  private Bool manFocus := false</span>
<span id='line363'><b>}</b></span>
<span id='line364'></span>
<span id='line365'>**************************************************************************</span>
<span id='line366'>** TreeSelection</span>
<span id='line367'>**************************************************************************</span>
<span id='line368'></span>
<span id='line369'>@Js internal class TreeSelection : Selection</span>
<span id='line370'><b>{</b></span>
<span id='line371'>  new make<b>(</b>Tree tree<b>)</b> <b>{</b> this.tree = tree <b>}</b></span>
<span id='line372'></span>
<span id='line373'>  override Bool isEmpty<b>(</b><b>)</b> <b>{</b> items.isEmpty <b>}</b></span>
<span id='line374'></span>
<span id='line375'>  override Int size<b>(</b><b>)</b> <b>{</b> items.size <b>}</b></span>
<span id='line376'></span>
<span id='line377'>  override Obj? item</span>
<span id='line378'>  <b>{</b></span>
<span id='line379'>    get <b>{</b> items.first <b>}</b></span>
<span id='line380'>    set <b>{</b> items = <b>(</b>it == null<b>)</b> ? Obj<b>[</b>,<b>]</b> : <b>[</b>it<b>]</b> <b>}</b></span>
<span id='line381'>  <b>}</b></span>
<span id='line382'></span>
<span id='line383'>  override Obj<b>[</b><b>]</b> items := <b>[</b>,<b>]</b></span>
<span id='line384'>  <b>{</b></span>
<span id='line385'>    set</span>
<span id='line386'>    <b>{</b></span>
<span id='line387'>      if <b>(</b>!enabled<b>)</b> return</span>
<span id='line388'>      oldItems := &amp;items</span>
<span id='line389'>      newItems := <b>(</b>multi ? it : <b>(</b>it.size > 0 ? <b>[</b>it.first<b>]</b> : Obj<b>[</b>,<b>]</b><b>)</b><b>)</b>.ro</span>
<span id='line390'>      &amp;items = newItems</span>
<span id='line391'>      tree.onUpdateSel<b>(</b>oldItems, newItems<b>)</b></span>
<span id='line392'>    <b>}</b></span>
<span id='line393'>  <b>}</b></span>
<span id='line394'></span>
<span id='line395'>  // TODO: unless we can make index meaningful/useful and performant</span>
<span id='line396'>  // its probably better to fail fast so its not used</span>
<span id='line397'></span>
<span id='line398'>  override Int? index</span>
<span id='line399'>  <b>{</b></span>
<span id='line400'>    get <b>{</b> throw Err<b>(</b>"Not implemented for Tree"<b>)</b> <b>}</b></span>
<span id='line401'>    set <b>{</b> throw Err<b>(</b>"Not implemented for Tree"<b>)</b> <b>}</b></span>
<span id='line402'>  <b>}</b></span>
<span id='line403'></span>
<span id='line404'>  override Int<b>[</b><b>]</b> indexes</span>
<span id='line405'>  <b>{</b></span>
<span id='line406'>    get <b>{</b> throw Err<b>(</b>"Not implemented for Tree"<b>)</b> <b>}</b></span>
<span id='line407'>    set <b>{</b> throw Err<b>(</b>"Not implemented for Tree"<b>)</b> <b>}</b></span>
<span id='line408'>  <b>}</b></span>
<span id='line409'></span>
<span id='line410'>  private Tree tree</span>
<span id='line411'><b>}</b></span>
</pre>
</div>
</body>
</html>
